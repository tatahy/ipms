<!-- assList.html -->

<!-- pagewrap  -->	
<div>
	<!-- <p>{$authAss.edit}</p> -->
	<p id="pSearchResultNum"><strong>列表记录总数：</strong><span class="label label-info">{$searchResultNum}</span></p>
	<!-- // 表格排序信息汇总组件 -->
	<div id="divTblSortData" data-sort-name="{$sortData.sortName}" data-sort-order="{$sortData.sortOrder}" data-list-rows="{$sortData.listRows}" data-page-num="{$sortData.pageNum}"></div>
	<div class="table-responsive" > 
		<table  class="table table-bordered table-striped table-hover table-condensed" >
			<caption class="text-center" style="border-bottom:1px solid #eee;"><h4>固定资产概况列表</h4></caption>
			<thead>
				<tr>
					<th class="text-center">序号</th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="brand_model">名称</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="assnum">编号</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="code">卡号</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo" data-sort-name="bar_code">条形码号</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="place_now">现放置地点</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="quantity">数量</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="dept_now">现使用部门</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="keeper_now">现保管人</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="status_now">状态</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="status_now_user_name">登记人</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="create_time">登记时间</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="update_time">更新时间</a></th>
					<th class="text-center"><a class="" data-title="点击排序" data-toggle="tooltip" href="#assInfo"  data-sort-name="oprt">操作</a></th>
				</tr>
			
			</thead>
			<tbody><!-- 此处显示数据库查询后的数据集 -->
				{volist name="assSet" id="vo" empty="暂时没有数据"}
				<tr>
					<td class="text-center">{$i+($sortData.pageNum-1)*$sortData.listRows}</td>
					<td>{$vo.brand_model}</td>
					<td>{$vo.assnum}</td>
					<td>{$vo.code}</td>
					<td>{$vo.bar_code}</td>
					<td>{$vo.place_now}</td>
					<td>{$vo.quantity}</td>
					<td>{$vo.dept_now}</td>
					<td>{$vo.keeper_now}</td>
					<td>{$vo.status_now}</td>
					<td>{$vo.status_now_user_name}</td>
					<td>{$vo.create_time}</td>
					<td>{$vo.update_time}</td>
					<td class="btnAssOprt">
						{eq name="authAss.edit" value="1"}
						<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_UPDATE"><span class="glyphicon glyphicon-pencil text-primary"></span>_更新&nbsp;</a>
						
						<button class="aAssOprt btn btn-xs btn-primary"  data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_UPDATE"><span class="small glyphicon glyphicon-pencil"></span>更新</button>
						
							{in name="vo.status_now" value="*,新增(待分配)"}
							<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_DELETE"><span class="glyphicon glyphicon-trash text-danger"></span>_删除&nbsp;</a>
							{/in}
						{/eq}
						
						{eq name="authAss.audit" value="1"}
						
						<!-- // 对应软删除的处理 -->
							{empty name="vo.delete_time"}
							<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}" data-ass-oprt="_AUDIT" ><span class="glyphicon glyphicon-check text-warning"></span>_审核&nbsp;</a>
							<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_DELETE_TRUE"><span class="glyphicon glyphicon-remove text-danger"></span>_永久删除&nbsp;</a>
							{else/}
							<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_RESTORE"><span class="glyphicon glyphicon-retweet text-success"></span>_还原&nbsp;</a>
							<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_DELETE_TRUE"><span class="glyphicon glyphicon-remove text-danger"></span>_永久删除&nbsp;</a>
							{/empty}
						{/eq}
						
						{eq name="authAss.approve" value="1"}
						<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_APPROVE" ><span class="glyphicon glyphicon-check text-danger"></span>_审批&nbsp;</a>
						{/eq}
						
						{eq name="authAss.maintain" value="1"}
						<a class="aAssOprt" href="#assInfo" data-ass-id="{$vo.id}" data-ass-topic="{$vo.brand_model}"  data-ass-oprt="_MAIINTAIN" ><span class="glyphicon glyphicon-calendar text-danger"></span>_维护&nbsp;</a>
						{/eq}
					</td>
				
				</tr>
				{/volist}
			
			</tbody>
			
		</table>
	
	</div>
	
	
	<div id="divListRows" class="col-sm-12 text-right">
		<!-- // 分页变量 -->
		<div class="col-sm-10 text-right">{$assList}</div>
		
		<div class="form-group form-group-sm col-sm-2">
			<span class="">每页显示记录数：</span>
			<select class="form-control" id="listRows">
				<option value="5">5</option>
				<option value="10">10</option>
				<option value="20">20</option>
				<option value="50">50</option>
			</select>
						
		</div>
	
	</div>
	
</div>

<!-- /pagewrap  -->

<script>

var urlPrefix='{$home}/dashboard/asset/';

var assAuthObj={$authAssObj};
//console.dir(authAssObj);

var assStatusArr={$assStatusArr};
console.log(assStatusArr);

//根据登录用户的权限assAuth，固定资产的状态值assStatus，得到操作固定资产的组件的html字符串
var getHtmlStr=()=>{

	

}; 

$(document).ready(function(){
	$('#tblAssList').data('sortOrder','{$sortData.sortOrder}');
	
	<!-- //表格每页显示记录行数 -->
	$('#listRows').val('{$sortData.listRows}'); 
	
	$('#listRows').change(function(){
		var listRows=$(this).val();
		//排序有关的值向$('#divTblSortData')汇集
		if(listRows){
			$('#divTblSortData').data('listRows',listRows);
		}
		//调用index.html中的loadAssList()
		loadAssList();
	});	
	
	$('thead a').click(function(){
		var sortName=$(this).data('sortName');
		var sortOrder=$(this).data('sortOrder');
		//排序有关的值向$('#divTblSortData')汇集
		if(sortName){
			$('#divTblSortData').data('sortName',sortName);
		}
		if(sortOrder){
			$('#divTblSortData').data('sortOrder',sortOrder);
		}
		
		//$('#tblAssList').data('sortOrder',$(this).data('sortOrder'));
		//调用index.html中的loadAssList()
		loadAssList();
		
	});	
	
	<!-- // 点击分页中的a，表格中的内容根据a中的属性值进行排序 -->
	$('#divListRows a').click(function(evt){
		// a所在分页页数
		var pageStr=$(this).text();
		var pageNum;
		//(li.active)所代表的页数
		var pageNumActive=$('#divListRows li.active').children('span').text();
		var sortName=$('thead').find('.label').data('sortName');
		var sortOrder=$('#tblAssList').data('sortOrder');
		<!-- var sortObj=$('thead').find('.label'); -->
		
		evt.preventDefault();
		
		switch(pageStr){
			case'»':
				//用"*"确保得到的是加法运算结果，而不是字符串
				pageNum=(pageNumActive*1+1);
			break;
			
			case'«':
				pageNum=(pageNumActive*1-1);
			break;
			
			default:
				pageNum=pageStr*1;
			break;
		
		}
		
		//排序有关的值向$('#divTblSortData')汇集
		if(pageNum){
			$('#divTblSortData').data('pageNum',pageNum);
		}
		//调用index.html中的loadAssList()
		loadAssList();
		
	});
	
	$('.aAssOprt').click(function(){
		var data={'oprt':$(this).data('assOprt'),'id':$(this).data('assId')}
		$('#divLoadAssSingle').load(urlPrefix+'modalAssSingle',data);
		$('#modalAssSingle').find('.title').html('【'+$(this).html()+'】固定资产');
		$('#modalAssSingle').modal();
		
	});
	
	
});
</script>

