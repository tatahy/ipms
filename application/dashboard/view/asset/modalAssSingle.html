<!-- modalAssSingle.html -->

<form id="fmAssInfo" role="form" action="{$home}/dashboard/asset/assOprt"  method="post">
	<input id="id" type="text" name="id" value="{$assSet.id}" class="sr-only">
	<input id="oprt" type="text" name="oprt" value="{$oprt}" class="sr-only">
	
	<div class="row">
	<div class="form-group col-sm-4">
		<label for="brand_model">名称（含品牌、型号）<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" name="brand_model" value="{$assSet.brand_model}" type="text" required>
	
	</div>
	
	<div class="form-group col-sm-3">
		<label for="code">卡号<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" name="code" value="{$assSet.code}" type="text" required>
	
	</div>
	
	<div class="form-group col-sm-3">
		<label for="bar_code">条形码号<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" id="" name="bar_code" value="{$assSet.bar_code}" type="text" required>
	
	</div>
	
	<div class="form-group col-sm-2">
		<label for="assnum">编号<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" id="" name="assnum" value="{$assSet.assnum}" type="text" required>
	
	</div>
	</div>
	
	<div class="row">
	<div class="form-group col-sm-2">
		<label for="quantity">数量<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" name="quantity" value="{$assSet.quantity}" type="text" required>
	
	</div>
	
	<div class="form-group col-sm-3">
		<label for="place_now">现放置地点<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" name="place_now" value="{$assSet.place_now}" type="text" required>
	
	</div>
	
	<div class="form-group col-sm-5">
		<label for="dept_now">现使用部门<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" name="dept_now" value="{$assSet.dept_now}" type="text" required>
	
	</div>
	
	<div class="form-group col-sm-2">
		<label for="keeper_now">现保管人<span class="small glyphicon glyphicon-asterisk text-danger"></span></label>
		<input class="form-control empty-check" id="" name="keeper_now" value="{$assSet.keeper_now}" type="text" required>
	
	</div>
	</div>
	
	<div class="row">
	<div class="form-group col-sm-2">
		<label for="status_now">状态</label>
		{in name="oprt" value="_CREATE,_DELETE"}
		<input class="form-control empty-check" name="status_now" value="{$assSet.status_now}" type="text" readonly>
		{else/}
		<select class="form-control" id="modalStatusNow" name="status_now" >
			<option value="">d1</option>
		</select>
		{/in}
	
	</div>
	
	<div class="form-group col-sm-3">
		<label for="status_now_user_name">登记人</label>
		{eq name="oprt" value="_CREATE"}
		<input class="form-control empty-check" name="status_now_user_name" value="{$userName}" type="text" readonly>
		{else/}
		<input class="form-control empty-check" name="status_now_user_name" value="{$assSet.status_now_user_name}" type="text" required>
		{/eq}
	
	</div>
	</div>
	<hr>
	<div class="row myRow">
	
	<div class="pull-left">
		{eq name="oprt" value="_DELETE"}
		<button type="submit" id="btnDelete" class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-remove"></span>删除</button>
		{else/}
		<button type="submit" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-send"></span>&nbsp;提交</button>
		{/eq}
	</div>
	
	<div  class="pull-right">
		<input id="btnReset" type="button" class="btn btn-primary btn-sm" value="重置">
		<input type="button" class="btn btn-warning btn-sm" data-dismiss="modal" value="取消">
	</div>
	
	</div>
	
</form>



<script>

//oprt英文转中文，加上HTML标签组成HTML字符串
var oprtToHtml=(en)=>{
	var arr=[{name:'新增', value:'_CREATE'}, {name:'更新', value:'_UPDATE'}, {name:'删除', value:'_DELETE'}, {name:'审核', value:'_AUDIT'}, {name:'审批', value:'_APPROVE'}, {name:'维护', value:'_MAINTAIN'}];
	var result = '';
	var labelTypt='';
	var htmlStr='';
	
	for(var i=0;i<arr.length;i++){
		if (en==arr[i].value){
			result = arr[i].name;
			break;
		}
	}
	
	switch(en){
		case '_DELETE':
			labelTypt='danger';
			break;
		case '_APPROVE':
			labelTypt='warning';
			break;
		default:
			labelTypt='info'
			break;
	}
	htmlStr='<span class="label label-'+labelTypt+'">'+result+'</span>';
	return htmlStr;
};

$(document).ready(function(){
	
	if('_CREATE'!='{$oprt}' || '_DELETE'!='{$oprt}'){
		ajaxShowSelect({sendData:{req:$('#modalStatusNow').attr('name'),source:'common'},'attach':'',selected:'{$assSet.status_now}',obj:$('#modalStatusNow')});	
	}
	
	$('#fmAssInfo').submit(function(evt){
		var url = this.action; 
    	var formData = $(this).serialize();
		var topic=$(this).find('[name="brand_model"]').val();
		var oprt=$(this).find('[name="oprt"]').val();
		var str='<p>固定资产：</p><p class="text-center">【<strong>'+topic +'</strong>】</p><p class="text-center">'+oprtToHtml(oprt)+'</p>';
		console.log(url);
		console.dir(formData);
		evt.preventDefault();
		$('#modalAssSingle').modal('hide');
		$.confirm(str,function(e){
			con=e;
			if(true==con){
				$.post(url,formData,function(data){
					if(data){
						str+='<p class="text-center"><span class="text-success"><strong>成功</strong></span></p>';
					}else{
						str+='<p class="text-center"><span class="text-danger"><strong>失败</strong></span></p>';
					}
					$.alert(str);
					loadAssList();
				});
			}else{
				$('#modalAssSingle').modal('show');
			}
		}).cancel('否(N)').ok('是(Y)');	
	});
	

});

</script>

