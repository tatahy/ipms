<!DOCTYPE html>
<html lang="en">
<head>
  <title>[title]</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {/* TP5中的模板注释格式，多行。内容不会出现在发送给浏览器的HTML文件中
  <!-- 使用cdn提高解析速度 -->
  <!-- <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.bootcss.com/bootstrap/3.3.6/css/bootstrap3.3.7.min.css">
  <script src="https://ajax.googleapis.bootcss.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
   */}
  
 {// TP5中的模板注释格式，单行。<!-- TP5的资源文件加载写法 -->内容不会出现在发送给浏览器的HTML文件中 }  
  {css href="/home/res/css/bootstrap3.3.7.min.css" }
  {css href="/home/res/css/style.css" }
  {js href="/home/res/js/jquery1.12.4.min.js" }
  {js href="/home/res/js/bootstrap3.3.7.min.js" } 

  {// TP5中的模板注释格式，单行。<!-- 自定义的页面弹窗 -->}  
  {js href="/home/res/js/alert.min.js" }


{/*<!-- 实现nav固定在页面顶端效果的补充代码块,
同时还需设置nav的data-offset-top="-3"防止鼠标单击页面时出现跳动-->
*/}
<style>
  .affix {
      top: 0;
      width: 100%;
  }

  .affix + .container-fluid {
      padding-top: 60px;
  }
  
body {
  	/* Margin bottom by footer height */
  	margin-bottom: 70px;
}  

.mainFrame{
	margin: 0 10%;
	padding-top:60px;
}

footer {
	//border:1px solid #e3e3e3;
	background-color:#f5f5f5;
	padding:5px 0;	
	position: fixed;
	/* 确保footer遮盖了分页显示*/
	z-index: 9;
	bottom:0;
	width: 100%;
	/* Set the fixed height of the footer here */
	height: 70px;
  
}

@media screen and (max-width: 767px) {
body {
  	/* Margin bottom by footer height */
  	margin: 0;
} 

.mainFrame{
	margin: 0;
}

footer {
	position: relative;
	background-color:#ffffff;
	border-top:1px solid #e3e3e3;
	padding-top:10px;
	margin-top:40px;
}

}
  
</style>

</head>
<body>

<!-- pageheader  -->
<nav class="navbar navbar-default navbar-fixed-top" data-spy="affix" data-offset-top="-3">
  <div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#topNavbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>                        
			</button>
			<a class="navbar-brand" href="http://www.gzgjd.com" data-toggle="tooltip"  data-placement="bottom" title="GZOME主页" target="_blank"><strong>IPMS</strong>
				<img src="/home/res/images/logo.png" class="img-responsive img-circle margin" style="display:inline" width="45" height="40">
			</a>
		</div>
    <div id="topNavbar" class="collapse navbar-collapse" >
      <ul class="nav navbar-nav">
	  <!-- // jQ生成li组件-->
	  	<!-- //组件模型 -->
        <!-- <li id="nav_index"><a href="{$home}/index/index/index"><span class="glyphicon glyphicon-home"></span>&nbsp;首页</a></li> -->
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="{$home}/dashboard/index/index#userInfo"><span class="glyphicon glyphicon-user"></span>&nbsp;【{$username}】个人中心</a></li>	
        <li id="liQuit"><a href="{$home}/index/index/logout"><span class="glyphicon glyphicon-log-out"></span>&nbsp;退出</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- // 向后端请求数据汇总组件 -->
<div id="divRqData" data-url="" data-ent="" data-period="" class="sr-only"></div>
<!-- /pageheader  -->

<script>

const urlPrex='{$home}',
	glyPrex='glyphicon glyphicon-',
	//归纳bootStrap3中的颜色相关属性
	bs3Color={
		//info
		info:{lab:'label label-info',btn:'btn-info',txt:'text-info',bg:'bg-info',alt:'alert-info',pan:'panel panel-info'},
		//success
		success:{lab:'label label-success',btn:'btn-success',txt:'text-success',bg:'bg-success',alt:'alert-success',pan:'panel panel-success'},
		//danger
		danger:{lab:'label label-danger',btn:'btn-danger',txt:'text-danger',bg:'bg-danger',alt:'alert-danger',pan:'panel panel-danger'},
		//warning
		warning:{lab:'label label-warning',btn:'btn-warning',txt:'text-warning',bg:'bg-warning',alt:'alert-warning',pan:'panel panel-warning'},
		//primary
		primary:{lab:'label label-primary',btn:'btn-primary',txt:'text-primary',bg:'bg-primary',pan:'panel panel-primary'},
		//default
		'default':{lab:'label label-default',btn:'btn-default'},
		//muted
		muted:{text:'text-muted'},
		//link
		link:{btn:'btn-link'}
	},
	//nav中li组件主要属性
	navEntProp={
		index:{id:'nav_index',url:urlPrex+'/index/index/index',period:'',gly:glyPrex+'home',chi:'首页'},
		pat:{id:'nav_pat',url:urlPrex+'/patent/index/index',period:'total',gly:glyPrex+'wrench',chi:'专利'},
		ass:{id:'nav_ass',url:urlPrex+'/asset/index/index',period:'_ASSS_USUAL',gly:glyPrex+'oil',chi:'固定资产'},
		the:{id:'nav_the',url:urlPrex+'/thesis/index/thelist',period:'total',gly:glyPrex+'list',chi:'论文'},
		pro:{id:'nav_pro',url:urlPrex+'/index/index/index',period:'total',gly:glyPrex+'inbox',chi:'项目'},
	};
	
var num={$num};
	
//根据定义的navEntProp生成"navLi"组件
var buildNavLiCom=()=>{ 
	let r=$('#topNavbar .navbar-nav').eq(0),
		entity=($('#divRqData').data('ent'))?$('#divRqData').data('ent'):'index';
		
	for(let ent in navEntProp){
		let e=navEntProp[ent],
			n=num[ent],
			a=$('<a></a>').data('ent',ent).append($('<span></span>').addClass(e.gly),'&nbsp;',e.chi),
			rC=$('<li></li>').attr('id',e.id);
		
		if(ent!='index' && n==0){
			rC.addClass('disabled');
		}	
		
		if(ent=='index' || typeof n=='object'){
			a.css('cursor','pointer');
		}	
		rC.append(a);
		r.append(rC);
	}
	<!--为li标签（id为含有entity）添加.active -->
	$('[id*="'+entity+'"]').addClass('active');
	
	console.log(entity);
	
}

//load模块对应的Index文件
var loadIndex=()=>{
	let obj=$('#main'),
		loadStr='<p class="text-center" style="font-size:20px;padding-top:20px;">加载中……</p>',
		dataObj=$('#divRqData'),
		rqData={ent:dataObj.data('ent'),period:dataObj.data('period')},
		url=(dataObj.data('url')=='')?urlPrex+'/index/index/index':navEntProp[rqData.ent]['url'];
	
	if(rqData.ent=='index'){
		return window.location.href=urlPrex+'/index/index/index';
	}
	
	console.log('loadIndex():');
	<!-- //load指定文件 -->	
	obj.html(loadStr).load(url,rqData,function(){
	
		console.log(url);
		console.log(rqData);	
		window.location.href=url+'#'+rqData.period;
		<!-- window.location.hash='#'+rqData.period; -->
		<!-- console.log(window.location.href); -->
	});
	
};


//利用自调用匿名函数立即执行的特点，页面初始化
(function($){
	buildNavLiCom();
	// 激活tooltip
	$('[title]').tooltip();	   
})(jQuery);

$(document).ready(function(){
	let navLiSet=$('[id^="nav_"]');
	
	navLiSet.children('a').click(function(){
		let dataObj=$('#divRqData'),
			cls=$(this).closest('li').attr('class')?$(this).closest('li').attr('class'):'no class';
		
		for(let ent in navEntProp){
			let e=navEntProp[ent];
			if($(this).data('ent')==ent){
				dataObj.data('url',e.url);
				dataObj.data('ent',ent);
				dataObj.data('period',e.period);
			}
		}
		
		if(cls.indexOf('disabled')==-1){
			loadIndex();
			<!-- 本级li标签添加.active -->
			navLiSet.removeClass('active');
			$(this).closest('li').addClass('active');
		}
		
	});

});
</script>