<!DOCTYPE html>
<html lang="en">
<head>
  <title>IPMS</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {/* TP5中的模板注释格式，多行。内容不会出现在发送给浏览器的HTML文件中
  <!-- 使用cdn提高解析速度 -->
  <!-- <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.bootcss.com/bootstrap/3.3.6/css/bootstrap3.3.7.min.css">
  <script src="https://ajax.googleapis.bootcss.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
   */}
  
 {// TP5中的模板注释格式，单行。<!-- TP5的资源文件加载写法 -->内容不会出现在发送给浏览器的HTML文件中 }  
  {css href="/home/res/css/bootstrap3.3.7.min.css" }
  {css href="/home/res/css/style.css" }
  {js href="/home/res/js/jquery1.12.4.min.js" }
  {js href="/home/res/js/bootstrap3.3.7.min.js" } 

  {// TP5中的模板注释格式，单行。<!-- 自定义的页面弹窗 -->}  
  {js href="/home/res/js/alert.min.js" }


{/*<!-- 实现nav固定在页面顶端效果的补充代码块,
同时还需设置nav的data-offset-top="-3"防止鼠标单击页面时出现跳动-->
*/}
<style>
  .affix {
      top: 0;
      width: 100%;
  }

  .affix + .container-fluid {
      padding-top: 60px;
  }
  
body {
  	/* Margin bottom by footer height */
  	margin-bottom: 70px;
}  

.mainFrame{
	margin: 0 10%;
	padding-top:60px;
}

footer {
	//border:1px solid #e3e3e3;
	background-color:#f5f5f5;
	padding:5px 0;	
	position: fixed;
	/* 确保footer遮盖了分页显示*/
	z-index: 9;
	bottom:0;
	width: 100%;
	/* Set the fixed height of the footer here */
	height: 70px;
  
}

@media screen and (max-width: 767px) {
body {
  	/* Margin bottom by footer height */
  	margin: 0;
} 

.mainFrame{
	margin: 0;
}

footer {
	position: relative;
	background-color:#ffffff;
	border-top:1px solid #e3e3e3;
	padding-top:10px;
	margin-top:40px;
}

}
  
</style>

</head>
<body>
<!-- pageheader  -->
<nav class="navbar navbar-default navbar-fixed-top" data-spy="affix" data-offset-top="-3">
  <div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#topNavbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>                        
			</button>
			<a class="navbar-brand" href="http://www.gzgjd.com" title="GZOME主页" target="_blank"><strong>IPMS</strong>
				<img src="/home/res/images/logo.png" class="img-responsive img-circle margin" style="display:inline" width="45" height="40">
			</a>
		</div>
    <div id="topNavbar" class="collapse navbar-collapse" >
      <ul class="nav navbar-nav">
	  <!-- // jQ生成li组件-->
	  	<!-- //组件模型 -->
        <!-- <li><a href="{$home}/index/index/index"><span class="glyphicon glyphicon-home"></span>&nbsp;首页</a></li> -->
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="{$home}/dashboard/index/index#userInfo" title="点击进入“个人中心”"><span class="glyphicon glyphicon-user"></span>&nbsp;【{$username}】个人中心</a></li>	
        <li id="liQuit"><a href="{$home}/index/index/logout"><span class="glyphicon glyphicon-log-out"></span>&nbsp;退出</a></li>
      </ul>
    </div>
  </div>
</nav>

<div id="mainRow" class="mainFrame container-fluid" style="padding-top: 70px;">
<!-- //jQ产生参考模型	 -->
	<!-- <div class="row"> -->
		<!-- <div class="col-sm-6"> -->
			<!-- <div class="panel-group"> -->
				<!-- <div class="panel panel-default"> -->
					<!-- <div class="panel-heading"><span class="glyphicon glyphicon-wrench"></span>&nbsp;<strong>专利概况</strong></div> -->
					<!-- <div class="panel-body"> -->
						<!-- <a href="{$home}/patent/index/index#newAdd" class="btn-info">拟申报专利数：<span class="badge">{ $num.pat.newAdd}</span></a> -->
						<!-- <a href="{$home}/patent/index/index#apply" class="btn-primary">申报专利数：<span class="badge">{ $num.pat.apply}</span></a> -->
						<!-- <a href="{$home}/patent/index/index#authorize" class="btn-success">有效专利数：<span class="badge">{ $num.pat.authorize}</span></a> -->
					
						<!-- <p class="text-center">无“专利”【查阅】权限，请与系统管理员联系。</p> -->
						
					<!-- </div> -->
					
				<!-- </div> -->
			<!-- </div> -->
		<!-- </div> -->
			
	<!-- </div> -->
</div>

<div id="mainPeriod" class="mainFrame container-fluid" style="padding-top: 70px;">	
	<!-- //jQ产生 -->

</div>

<footer>
	<div class="text-center">
		<span class=""><a href="#">联系我们</a>&nbsp;┆&nbsp;<a href="{$home}/admin/index/login">管理登录</a></span></br>
		<span class="">Powered by HY Copyright © {$year-1}-{$year} 广州市光机电技术研究院（GZOME）. All rights reserved</span></br>
		<span class="">为获得最佳的浏览效果，推荐使用<a href="#">Chrome</a>、 <a href="#">Firefox</a>浏览器</span></br>	
	</div>
</footer>

<script>
const domain='{$home}', //域名地址，由后端给定
	glyPrex='glyphicon glyphicon-',
	//归纳bootStrap3中的颜色相关属性
	bs3Color={
		info:{lab:'label label-info',btn:'btn-info',txt:'text-info',bg:'bg-info',alt:'alert-info',pan:'panel panel-info'},
		success:{lab:'label label-success',btn:'btn-success',txt:'text-success',bg:'bg-success',alt:'alert-success',pan:'panel panel-success'},
		danger:{lab:'label label-danger',btn:'btn-danger',txt:'text-danger',bg:'bg-danger',alt:'alert-danger',pan:'panel panel-danger'},
		warning:{lab:'label label-warning',btn:'btn-warning',txt:'text-warning',bg:'bg-warning',alt:'alert-warning',pan:'panel panel-warning'},
		primary:{lab:'label label-primary',btn:'btn-primary',txt:'text-primary',bg:'bg-primary',pan:'panel panel-primary'},
		//default
		'default':{lab:'label label-default',btn:'btn-default'},
		muted:{text:'text-muted'},
		link:{btn:'btn-link'}
	},
	//topNav中li组件主要属性
	topNavProp={
		index:{'url':domain+'/index/index/index',period:'',gly:glyPrex+'home',chi:'首页'},
		pat:{'url':domain+'/patent/index/index',period:'total',gly:glyPrex+'wrench',chi:'专利'},
		ass:{'url':domain+'/asset/index/index',period:'_ASSS_USUAL',gly:glyPrex+'oil',chi:'固定资产'},
		pro:{'url':domain+'/project/index/index',period:'total',gly:glyPrex+'inbox',chi:'项目'},
		the:{'url':domain+'/thesis/index/index',period:'total',gly:glyPrex+'list',chi:'论文'}
	},
	urlIndex=domain+'/index/index/index',
	noneSufx='模块无【查阅】权限，请与系统管理员联系。';

//定义前端系统各个实体主要属性(用于jQ构建组件)
const entProp={
	pat:{
		url:domain+'/patent/index/index',
		txt:'专利概况',
		gly:glyPrex+'wrench',
		period:{
			clsName:'patPeriod',
			summary:[
				{name:'newAdd',txt:'拟申报专利数：',color:bs3Color['info']['btn']},
				{name:'apply',txt:'申报专利数：',color:bs3Color['primary']['btn']},
				{name:'authorize',txt:'有效专利数：',color:bs3Color['success']['btn']}
			],
			detail:[
				{name:'total',txt:'专利概况'},
				{name:'audit',txt:'内审'},
				{name:'newAdd',txt:'拟申报'},
				{name:'apply',txt:'申报'},
				{name:'authorize',txt:'授权(有效)'},
				{name:'invalid',txt:'无授权(无效)'}
			]
		},
		noneTxt:'“专利”'+noneSufx
	},
	ass:{
		url:domain+'/asset/index/index',
		txt:'固定资产',
		gly:glyPrex+'oil',
		period:{
			clsName:'assPeriod',
			summary:[
				{name:'_ASSS1',txt:'待定数：',color:bs3Color['info']['btn']},
				{name:'_ASSS2',txt:'正常数：',color:bs3Color['success']['btn']},
				{name:'_ASSS3',txt:'异常数：',color:bs3Color['warning']['btn']},
				{name:'_ASSS4',txt:'停用数：',color:bs3Color['default']['btn']}
			],
			detail:[
				{name:'_ASSS_USUAL',txt:'固定资产概况'},
				{name:'_ASSS1',txt:'待定'},
				{name:'_ASSS2',txt:'正常'},
				{name:'_ASSS3',txt:'异常'},
				{name:'_ASSS4',txt:'停用'},
				{name:'_ASSS5',txt:'销账'}
			]
		},
		noneTxt:'“固定资产”'+noneSufx
	},
	pro:{
		url:domain+'/project/index/index',
		txt:'项目概况&nbsp;<span class="bg-primary">&nbsp;开发中&nbsp;</span>',
		gly:glyPrex+'inbox',
		period:{
			clsName:'proPeriod',
			summary:[
				{name:'plan',txt:'拟申报项目数：',color:bs3Color['info']['btn']},
				{name:'apply',txt:'申报项目数',color:bs3Color['primary']['btn']},
				{name:'approve',txt:'立项项目数：',color:bs3Color['warning']['btn']},
				{name:'process',txt:'在研项目数：',color:bs3Color['primary']['btn']},
				{name:'done',txt:'结题项目数：',color:bs3Color['success']['btn']},
				{name:'terminate',txt:'终止项目数：',color:bs3Color['default']['btn']}
			],
			detail:[
				{name:'total',txt:'项目总体情况'},
				{name:'audit',txt:'内审'},
				{name:'plan',txt:'拟申报'},
				{name:'apply',txt:'申报'},
				{name:'approve',txt:'立项'},
				{name:'process',txt:'在研'},
				{name:'inspect',txt:'验收'},
				{name:'done',txt:'结题'},
				{name:'terminate',txt:'终止'},
				{name:'reject',txt:'申报未立项'}
			]
		},
		noneTxt:'“项目”'+noneSufx
	},
	the:{
		url:domain+'/thesis/index/index',
		txt:'论文概况&nbsp;<span class="bg-primary">&nbsp;开发中&nbsp;</span>',
		gly:glyPrex+'list',
		period:{
			clsName:'thePeriod',
			summary:[
				{name:'plan',txt:'拟发表论文数：',color:bs3Color['info']['btn']},
				{name:'apply',txt:'投稿论文数：',color:bs3Color['primary']['btn']},
				{name:'publish',txt:'发表论文数：',color:bs3Color['success']['btn']}
			],
			detail:[
				{name:'total',txt:'论文总体情况'},
				{name:'audit',txt:'内审'},
				{name:'plan',txt:'拟发表'},
				{name:'apply',txt:'投稿'},
				{name:'accept',txt:'收录'},
				{name:'publish',txt:'发表'},
				{name:'reject',txt:'拒稿'}
			]
		},
		noneTxt:'“论文”'+noneSufx
	}
};
//定义前端系统各个实体数量对象，由后端给定
const num={$num};

//向后端请求时的url
var url=domain+'/index/index/index';

//向后端请求时发送的数据
var	rqData={
		ent:'index',
		period:'',
		sortData:'',
		searchData:''
	};
	
//根据定义的topNavProp生成"navLi"组件
var buildTopNavbarCom=()=>{ 
	let r=$('#topNavbar .navbar-nav').eq(0),
		entity=rqData.ent;
	r.empty();
	for(let ent in topNavProp){
		let e=topNavProp[ent],
			n=num[ent],
			a=$('<a></a>').attr('data-ent',ent).append($('<span></span>').addClass(e.gly),'&nbsp;',e.chi),
			rC=$('<li></li>');
		
		if(ent!='index' && n==0){
			rC.addClass('disabled');
		}	
		
		if(ent=='index' || typeof n=='object'){
			a.css('cursor','pointer');
		}	
		rC.append(a);
		r.append(rC);
	}
	<!--为li标签添加.active -->
	$('[data-ent="'+entity+'"]').tab('show');
}

//根据定义的entProp生成"row"组件
var buildMainRowCom=()=>{
	let //计数器
		n=0,
		divSet=[];
	$('#mainRow').empty();
	//挨个生成ent组件
	for (let ent in num){
		let numObj=(typeof num[ent]=='object')?num[ent]:0;
			entObj=entProp[ent],
			p=$('<p></p>').addClass('text-center').text(entObj.noneTxt),
			panH=$('<div></div>').addClass('panel-heading').append($('<span></span>').addClass(entObj.gly),'&nbsp;',$('<strong></strong>').html(entObj.txt)),
			panB=$('<div></div>').addClass('panel-body'),
			pan=$('<div></div>').addClass('panel-group'),
			panType=$('<div></div>').addClass('panel panel-default'),
			div=$('<div></div>').addClass('col-sm-6');
		
		if(typeof numObj=='object'){
			entObj.period.summary.forEach(function(el){
				let num=numObj[el.name],
					href=entObj.url+'#'+el.name,
					btn=$('<button></button>').attr({'class':'btn btn-sm btnPeriod','title':'查看详情'}).css({'margin':'2px','font-size':'14px'}),
					spBdg=$('<span></span>').addClass('badge');
								
				spBdg.text(num);
				btn.attr({'data-url':entObj.url,'data-ent':ent,'data-period':el.name}).addClass(el.color).append(el.txt,spBdg);
				panB.append(btn);
			});
		}		
		if(numObj==0){
			panB.append(p);
		}
		
		panType.append(panH,panB);
		pan.append(panType);
		//生成一个ent组件
		divSet[n]=div.append(pan);
		n++;
	}
	//每个row放置2个ent组件
	for(let i=0;i<Math.ceil(n/2);i++){		
		let r=$('<div></div>').addClass('row');
		r.append(divSet[2*i],divSet[(2*i+1)]);
		$('#mainRow').append(r);
	}
	
	//返回btnSet
	return $('#mainRow').find('.btnPeriod');
};

//根据定义的entProp生成"Nav"组件
var buildMainPeriodNavCom=(obj,ent)=>{
	let r=obj.css('border-bottom','1px solid #ddd'),
		pArr=entProp[ent].period.detail;
	
	pArr.forEach(function(e){
		let a=$('<a></a>').attr({'data-ent':ent,'data-period':e.name}).html(e.txt).css({'padding':'3px 10px','border-bottom-right-radius':'0px','border-bottom-left-radius':'0px','cursor':'pointer'}),
			rC=$('<li></li>');
			
		rC.append(a);
		r.append(rC);	
	});
	<!--为第一个li标签添加.active -->
	r.find('li').eq(0).addClass('active');
};

buildTopNavbarCom();
buildMainRowCom();
// 激活并设置tooltip
$('body').tooltip({selector:'[title]',triger:'hover click',placement: 'auto bottom',delay: {show: 200, hide: 100},html: true });	

$(document).ready(function(){
	let navASet=$('#topNavbar .navbar-nav').eq(0).find('a'),
		btnSet=$('#mainRow').find('.btnPeriod');
	navASet.click(function(){
		let cls=$(this).closest('li').attr('class')?$(this).closest('li').attr('class'):'no class';
		
		for(let ent in topNavProp){
			let e=topNavProp[ent];
			if($(this).data('ent')==ent){
				url=e.url;
				rqData.ent=ent;
				rqData.period=e.period;
			}
		}
		console.log(rqData);
		if(cls.indexOf('disabled')==-1){
			loadIndex();
		}
		
	});
	
	btnSet.click(function(){
		url=$(this).data('url');
		rqData.ent=$(this).data('ent');
		rqData.period=$(this).data('period');
		
		console.log(url);
		console.log(rqData);
		<!-- window.location.href=url+'#'+rqData.period; -->
		loadIndex();
		
	});
});

//load模块对应的Index文件
function loadIndex(){
	let row=$('#mainRow'),
		entity=$('#mainPeriod'),
		ent=rqData.ent,
		loadStr='<p class="text-center" style="font-size:20px;padding-top:20px;">加载中……</p>';
	
	row.hide();
	entity.empty().hide();
	
	url=topNavProp[rqData.ent]['url'];
	//id="topNavbar"里的li添加active
	$('[data-ent="'+ent+'"]').tab('show'); 
	
	if(ent=='index'){
		row.show();
	}else{
		entity.show().html(loadStr).load(url,rqData);
	}
}
//载入实体各个阶段下的列表
function loadEntPeriodList(obj){
	let loadStr='<p class="text-center" style="font-size:28px;">加载中……</p>';
	
	//id="xxPeriodNav"里的li添加active
	$('[data-period="'+rqData.period+'"]').tab('show'); 
	
	obj.html(loadStr).load(url,rqData);
	
}
//设置向后端请求时的查询数据
function setRqSearchData(searchObj=''){
	let formData='';
	//清空查询数据
	rqData.searchData={};
	
	if(typeof searchObj=='object'){
		//用户搜索有关键值对从表单searchObj获取
		formData=new FormData(searchObj.get(0));
		//使用Map对象的forEach方法组装hash数组
		formData.forEach(function(val,key){
			//非0非空的值才进行组装
			if(val!='' && val!=0){
				rqData.searchData[key]=val;
			}
		});		
	}
	
}

</script>

</body>
</html>



