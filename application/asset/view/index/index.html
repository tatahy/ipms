{include file="../application/common/header.html" title="固定资产信息" }

<!-- pagewrap  -->

<div class="container-fluid" style="padding-top: 55px;">
	
	<div id="divTopBtn" style="margin:10px 0px;">
		<span class="label label-info" style="font-size:16px;">固定资产总数
		</span>&nbsp;<span class="badge">{$quanCount}</span>&nbsp;
		<button id="btnSearchInfo" type="button" class="btn-link" data-toggle="tooltip" data-placement="bottom" title="显示/隐藏搜索条件"><span class="glyphicon glyphicon-collapse-down"></span><span>显示搜索</span></button>
				
		<button id="btnRefresh" type="button" class="btn-link" data-toggle="tooltip" data-placement="bottom" title="刷新列表"><span class="glyphicon glyphicon-refresh"></span>刷新</button>
	</div>
	<!-- // 搜索区域-->
	<div id="divSearchData" class="collapse">
		<div class="label label-info" style="font-size:14px;">搜索条件</div>
		<form id="fmAssSearch" style="border:1px solid #eee;padding:10px 0px 10px 0px;">
			
			<div class="row myRow">
			<div class="form-group col-sm-4">
				<label class="" for="brand_model">名称（品牌型号）</label>
				<input class="form-control" id="brand_model" name="brand_model" type="text" value="" placeholder="...不限">
										
			</div>
			<div class="form-group col-sm-2">
				<label class="" for="assnum">编号</label>
				<input class="form-control" id="assnum" name="assnum" type="text" value="" placeholder="...不限">
										
			</div>
			
			<div class="form-group col-sm-3">
				<label class="" for="code">卡号</label>
				<input class="form-control" id="code" name="code" type="text" value="" placeholder="...不限">
										
			</div>
			
			<div class="form-group col-sm-3">
				<label class="" for="bar_code">条形码号</label>
				<input class="form-control" id="bar_code" name="bar_code" type="text" value="" placeholder="...不限">
										
			</div>
			</div>
			
			<div class="row myRow">
			<div class="form-group col-sm-4">
				<label class="control-label" for="dept_now">现使用部门</label>
				<!-- <select multiple class="form-control" id="searchPatType" name="searchPatType" > -->
				<select class="form-control" id="selectDeptNow" name="dept_now" >
						<option value="">d1</option>
				</select>
			</div>
			<div class="form-group col-sm-2">
				<label class="control-label" for="status_now">状态</label>
				<!-- <select multiple class="form-control" id="searchPatType" name="searchPatType" > -->
				<select class="form-control" id="selectStatusNow" name="status_now" >
						<option value="">s1</option>
				</select>
			</div>
			<div class="form-group col-sm-4">
				<label class="" for="place_now">现放置地点</label>
				<select class="form-control" id="selectPlaceNow" name="place_now" >
						<option value="">p1</option>
				</select>
										
			</div>
			
			<div class="form-group col-sm-2">
				<label class="" for="keeper_now">现保管人</label>
				<select class="form-control" id="selectKeeperNow" name="keeper_now" >
						<option value="">k1</option>
				</select>
										
			</div>
			</div>			
			
			
			<div class="row myRow">
			<div class="col-sm-6">
				<button id="btnSearch" type="button" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-search"></span>搜索</button>
			
				<button id="btnSearchReset" type="button" class="btn btn-primary btn-sm">条件重置</button>
			</div>
			</div>
			
			<!-- <button id="btnAssSearch" type="button" class="btn btn-primary btn-sm">搜索&nbsp;<span class="glyphicon glyphicon-search"></span></button> -->
		
		</form>
		</br>
	</div>
	
	<!-- <p id="pSearchResultNum" hidden="true"><strong>搜索结果</strong>:&nbsp;<span class="label label-info">{ $searchResultNum}</span>条记录</p> -->
	
	<div id="divLoadAssList"><p class="text-center" style="font-size:20px;">加载中……</p></div>
	
	
</div>

<!-- /pagewrap  -->

<script>
var searchDataArr={$searchData};

console.dir(searchDataArr);


//**函数名：getJsonLength
 	//* 作用：得到jsonData的长度
var getJsonLength=(jsonData)=>{
	var jsonLength = 0;
	for(var item in jsonData){
		jsonLength++;
	}
 	return jsonLength;
};

//**函数名：glyphiconTextChange
 	//* 作用：obj内含的glyphicon进行变换
	//* 参数1：obj，String。值：必须，要交换glyphicon的obj
	//* 参数2：iconText1，Json。值：必须，{icon:'glyphicon-xx',text:'xx'}。
	//* 参数3：iconText2，Json。值：必须，{icon:'glyphicon-yy',text:'yy'}。
	//* 无返回值
var glyphiconTextChange=(obj,iconText1,iconText2)=>{
	iconText1=$.extend({icon:'glyphicon-collapse-up',text:'隐藏搜索'},iconText1);
	iconText2=$.extend({icon:'glyphicon-collapse-down',text:'显示搜索'},iconText2);
	if(obj.find('.'+iconText2.icon).length){
	    obj.find('.glyphicon').removeClass(iconText2.icon).addClass(iconText1.icon).next('span').html(iconText1.text);
    }else{
	    obj.find('.glyphicon').removeClass(iconText1.icon).addClass(iconText2.icon).next('span').html(iconText2.text);
    }
};

//**函数名：ajaxShowSelect
 	//* 作用：本页面ajax过程向服务器请求特定单选框内容所需数据，并组装好HTML语句
	//* 参数url，类型：字符串。值：不为空。说明：ajax操作的URL。
	//* 参数sendData，类型：数值。值：传送给后端的键值对数据。
	//* 参数obj，类型：对象。值：必须，单选框的对象名称
	//*参数attach，类型：json数组。值：可为空，需要附加的单选框的键值对，[{"text":"...不限","val":"0"},{"text":"xx","val":"xx"}]
	//*参数selected，类型：字符。值：字符，可为空。
	//* 返回值：无
var ajaxShowSelect=(options)=>{
	var defaults={
		'url':'selectResponse',
		'attach':[{"text":"...不限","val":"0"}],
		'sendData':'',
		'obj':'',
		'selected':'',
	};
	var data = $.extend({},defaults, options);
	var arrJson=data.attach;
	var req=data.sendData.req;
	var obj=data.obj;
	var selected=data.selected;
	var str='';
	
	$.post(data.url,data.sendData,function(result){
		if(arrJson.length){
			for(i=0;i<arrJson.length;i++){
				str+='<option value="'+arrJson[i].val+'">'+arrJson[i].text+'</option>';
			}
		}
		// result数组,取出value值组装HTML语句
		$.each(result,function(n1,v1){
			str+='<option value="'+v1+'">'+v1+'</option>';	
		});
		<!--// 清空单选框Obj的所有选项-->
		obj.empty();
		<!--// 添加单选框Obj的新选项-->
		obj.append(str);
		<!-- // value=selected 的项为选定项-->
		if (selected!=''){
			obj.val(selected);
		}
	});
};

//**函数名：loadAssList
 	//* 作用：加载本页面内容到指定div中<div id="divLoadAssList"></div>
	//* 参数1：listRows，Int。值：可为空，每页显示的记录行数。默认为10。
	//* 参数2：sortName，String。值：可为空，排序字段名称。默认为‘_TOPIC’。
	//* 参数3：sortOrder，String。值：可为空，排序方式。默认为'_ASC'。
	//* 参数4：pageNum，Int。值：可为空，当前页数。默认为1。
	//* 参数6：serchWord，Array。值：可为空，用户搜索关键词键值对。默认为空。
var loadAssList=(sortData)=>{
		
	//排序有关的参数默认值
	var sortDataDefault={'listRows':10,'sortName':'assnum','sortOrder':'asc','pageNum':1};
	sortData=$.extend({},sortDataDefault,sortData);
	
	//用户搜索有关键值对从表单$('#fmIssPatSearch')获取
	var formData=new FormData($('#fmAssSearch')[0]);
	
	var searchData={};
	//使用Map对象的forEach方法组装键值对
	formData.forEach(function(val,key,){
		//非0非空的值才进行组装
		if(val!='' && val!=0){
			searchData[key]=val;
		}
	});
	JSON.stringify(searchData);
	
	$('#divLoadAssList').html('<p class="text-center" style="font-size:20px;">加载中……</p>');
	
	//console.log('sortData:');
	//console.dir(sortData);
	
	// jquery load()方法，文件加载到本页面<div id="divLoadAssList"></div>
	$('#divLoadAssList').load('assList',
		{'sortData':sortData,'searchData':searchData},
		function(){
			sortOrderToggle(sortData.sortName);
		}
	);
};

//函数名：sortOrderToggle
//作用：对选定的assList列表字段进行升序降序转换，改变该字段表头显示格式
var sortOrderToggle=(sortName)=>{
	var obj='';
	var glyAsc='&nbsp;<span class="small glyphicon glyphicon-sort-by-attributes"></span>';
	var glyDesc='&nbsp;<span class="small glyphicon glyphicon-sort-by-order-alt"></span>';
	
	$('thead a').removeClass('label label-primary');
	
	$('thead a').each(function(){
		if(sortName==$(this).data('sortName')){
			obj=$(this);
		}else{
			$(this).tooltip({placement: 'bottom'});
		}
	});
		
	obj.addClass('label label-primary');
	
	if(obj.data('sortOrder') == 'asc'){
		//当前为升序
		obj.append(glyAsc);
		obj.tooltip({title:'当前为升序。点击后降序',placement: 'top'});
		obj.data('sortOrder','desc');
	}else{
		//当前为降序
		obj.append(glyDesc);
		obj.tooltip({title:'当前为降序。点击后升序',placement: 'top'});
		obj.data('sortOrder','asc');
	}
		
};

//搜索表单重置
var fmReset=()=>{
	var fm=$('#fmAssSearch');
	fm[0].reset();
	fm.find('.form-control').removeClass('label-info');
};

//利用自调用匿名函数立即执行的特点，设定$('#selectDeptNow')、$('#selectPlaceNow')、$('#selectKeeperNow')。
(function($,ajaxShowSelect){

	//设定$('#fmAssSearch')内的select组件的option
	$.when(
		ajaxShowSelect({sendData:{req:$('#selectDeptNow').attr('name')},obj:$('#selectDeptNow')}),
		ajaxShowSelect({sendData:{req:$('#selectStatusNow').attr('name')},obj:$('#selectStatusNow')}),
		ajaxShowSelect({sendData:{req:$('#selectPlaceNow').attr('name')},obj:$('#selectPlaceNow')}),
		ajaxShowSelect({sendData:{req:$('#selectKeeperNow').attr('name')},obj:$('#selectKeeperNow')}),
	).then(
		function(data, textStatus, jqXHR){
     		//ajax成功
			loadAssList();
		},
		function(){
			//ajax失败
			alert("失败Group，请稍后再试！");
		}
	);
})(jQuery,ajaxShowSelect);

$(document).ready(function(){
	// 设置各类tooltip
	$('#divTopBtn [data-toggle="tooltip"]').tooltip({triger:'focus',placement: 'auto bottom'});	
	
	<!-- 选中id为"nav_pat"的标签（header.html文件中的li标签）,添加.active -->
	$('#nav_ass').addClass('active');
	
	$('#btnSearchInfo').click(function(){
		
		//变换图标和内容
		glyphiconTextChange($(this));
		//显示、隐藏#divSearchData
		$('#divSearchData').collapse('toggle');
			
	});
	
	<!-- // 页面刷新 -->
	$('#btnRefresh').click(function(){
		//搜索表单重置
		fmReset();
		//$('#btnSearchInfo')恢复初始html
		$('#btnSearchInfo').html('<span class="glyphicon glyphicon-collapse-down"></span><span>显示搜索</span>');
		//隐藏搜索条件
		$('#divSearchData').collapse('hide');
		loadAssList();
	});
	

<!-- //表单$('#fmAssSearch')有关的代码块 -->
	
	$('#fmAssSearch .form-control').change(function(){
		
		if($(this).val()!=0){
			//表单输入框附加底色
			$(this).addClass('label-info');
		}else{
			//表单输入框去掉附加底色
			$(this).removeClass('label-info');
		}
	});
	
	//表单提交，开始asset搜索
	$('#btnSearch').click(function(){
		loadAssList();
	});
	
	//表单重置
	$('#btnSearchReset').click(function(){
		fmReset();
	});
	
<!-- function  -->


<!-- /function  -->
	
});
</script>

{include file="../application/common/footer.html"}
