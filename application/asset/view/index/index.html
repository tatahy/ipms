<!-- //module:asset, view:index/index.html  -->


<ul id="assPeriodNav" class="nav nav-pills">
	<!-- //jQ生成 -->
</ul>
<h4 id="assTitle" class="text-left">
	<!-- //jQ生成 -->
</h4>
<div id="divSearchBtn" class="text-right">
	<div class="btn-group">
    	<button id="btnSearchFormCollapse" type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-collapse-switch="main" title="显示/隐藏搜索条件">搜索条件</button>
			
    	<div class="btn-group">
			<button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">更多<span class="caret"></span></button>
      		<ul class="dropdown-menu" role="menu">
				<li class=""><a href="#divSearchForm" data-toggle="collapse" data-collapse-switch="li" title="根据输入信息搜索"><span class="glyphicon glyphicon-edit"></span>一般搜索</a></li>
    			<li role="separator" class="divider"></li>
    			<li class=""><a href="#divSearchFormBarcode" data-toggle="collapse" data-collapse-switch="li" title="输入/ 拍摄条形码图片<br>识别后搜索"><span class="glyphicon glyphicon-barcode"></span>条形码搜索</a></li>
      		</ul>
    	</div>
  	</div>
		
	<button id="btnRefresh" type="button" class="btn btn-primary btn-sm" title="刷新列表"><span class="glyphicon glyphicon-refresh"></span>刷新</button>
</div>

<!-- // 一般搜索区域-->
<div id="divSearchForm" class="collapse">
	<button class="btn btn-primary btn-xs" style="font-weight:700;border-bottom-left-radius:0px;border-bottom-right-radius:0px;" data-target="#divSearchForm"  data-toggle="collapse" data-collapse-switch="div" title="点击隐藏"><span class="glyphicon glyphicon-edit"></span>一般搜索条件</button>
	<!-- // 搜索表单-->
	<div id="searchForm">
	<!-- //jQ生成 -->
	</div>
</div>
	
<br>
	
<!-- // 条形码搜索区域-->
<div id="divSearchFormBarcode" class="collapse">
	<button class="btn btn-primary btn-xs" style="font-weight:700;border-bottom-left-radius:0px;border-bottom-right-radius:0px;" data-target="#divSearchFormBarcode"  data-toggle="collapse" data-collapse-switch="div" title="点击隐藏"><span class="glyphicon glyphicon-barcode"></span>条形码搜索</button>
		
	<!-- <div id="divBarcodeArea_load"><p class="text-center" style="font-size:20px;">加载中……</p></div> -->
	{include file="../application/common/decodeBarcode.html"}
</div>
	
<div id="searchNum">
	<p class="text-right bingo" style="padding-top:10px;"><button class="btn btn-info btn-sm" style="cursor:unset;font-size:14px;">搜索结果：<span class="badge"></span></button>
	</p>
		
	<p class="text-center none" style="padding-top:20px;"><strong>搜索结果</strong>：<span class="label label-default" style="font-size:16px;">无符合条件信息</span></p>
</div>
	
<div class="tab-content">
	<div id="assList">
	<!-- //jQ载入 -->
		<p class="text-center" style="font-size:20px;">加载中……</p>
	</div>
</div>	

<!-- Modal "modalAssSingle" -->
<div class="modal fade" id="modalAssSingle" role="dialog">
	<div class="modal-dialog modal-lg">
    
      <!-- Modal content-->
      	<div class="modal-content">
        <div class="modal-header bg-info" style="border-radius:5px;">
          	<button type="button" class="close" data-dismiss="modal">&times;</button>
		  
          	<h4 class="title"></h4>
        </div>
		
        <div class="modal-body">
			<!-- // 单个asset增删改查页面显示位置，需load其他模板文件的div-->
			<div id="divLoadAssSingle">
				<p class="text-center" style="font-size:28px;">加载中……</p>
			</div>
		</div>
		
		<div class="modal-footer">
        	<input type="button" class="btn btn-primary btn-sm" data-dismiss="modal" value="关闭"> 
        </div>
		</div>
	</div>

</div>

<!--/ Modal "modalAssSingle" -->

<script>
rqData.sortData.sortName='{$sortName}';

initPage();	

var collapseSwitchSet=$('[data-collapse-switch]'),
	collapseSwitchA=$('[data-collapse-switch="li"]'),
	collapseSwitchBtn=$('[data-collapse-switch="div"]');
	
//searchFormCollapse类
var searchFormCollapse=function(){
	//要求liSet.length==divSet.length
	var divSet=collapseSwitchBtn.parent();
	var liSet=collapseSwitchA.parent();
	
	//自调用匿名函数立即执行，进行赋值
	var formId=(function(){
			let arr=[];
			divSet.each(function(index){
				arr[index]=$(this).attr('id');
			});
			return arr;
		}());
	
	var fArr=Array(formId.length).fill(false);
	var prop={liShow:'active',divShow:'in',fn:{show:'show',hide:'hide'}};
	
	var statusDefault={trigger:{type:0,index:''},liShow:fArr,divShow:fArr};
	var status=statusDefault;
	
	var getStatus=()=>{
		divSet.each(function(){
			let idx=formId.indexOf($(this).attr('id'));
			
			if($(this).hasClass(prop.divShow)){
				status.divShow[idx]=true;
				status.liShow[idx]=true;
			}else{
				status.divShow[idx]=false;
				status.liShow[idx]=false;
			}	
		});
		return status;
	};
	
	var setStatus=(opt={})=>{
		status =$.extend({},statusDefault,opt);	
		return status;
	};
	//根据status对有关组件进行显示、隐藏
	var setCollapse=()=>{
		status.liShow.forEach(function(v,i){
			liSet.eq(i).removeClass(prop.liShow);
			if(v){
				liSet.eq(i).addClass(prop.liShow);
			}
		});
		status.divShow.forEach(function(v,i){
			(v)?divSet.eq(i).collapse(prop.fn.show):divSet.eq(i).collapse(prop.fn.hide);
		});
		return status;
	};
	
	return {
		formId:formId,
		getStatus:function(){return getStatus();},
		//返回本对象，实现链式操作。
		setStatus:function(opt){ setStatus(opt); return this;},
		setCollapse:function(){return setCollapse();}
	}
};

<!-- //点击nav中的各个按钮后，loadEntPeriodList()-->
$('#entPeriod').children('ul.nav').find('a').click(function(){	
	//排序、分页有关的值向sortData汇集
	rqData.period=$(this).data('period');
	rqData.sortData.pageNum=1;
	buildPeriodTitleCom();
	loadEntPeriodList();
});	

<!-- // 页面刷新 -->
$('#btnRefresh').click(function(){
	let obj=searchFormCollapse();
	//隐藏搜索条件
	$('#divSearchForm').removeClass('in');
	resetSearchForm();
	
	obj.setStatus().setCollapse();
});	

//3类共5个collapse-switch组件的click事件处理函数，
//任意时刻只有一个组件能click。记录触发click的组件特征值，由特征值决定组件的显示
collapseSwitchSet.click(function(){
	let obj=searchFormCollapse(),
		st=obj.getStatus(),
		type=$(this).data('collapseSwitch'),
		fArr=Array(st.liShow.length).fill(false);
	let reducer=(acc,cur)=>{
			if(cur){
				acc++;
			}
			return acc;
		};
	let idx='',
		showVal='';
			
	if(type=='main'){
		if(st.liShow.reduce(reducer,0)+st.divShow.reduce(reducer,0)){
			st.liShow=fArr;
			st.divShow=fArr;
		}else{
			st.liShow[0]=true;
			st.divShow[0]=true;
		}
	}
	if(type=='li'){
		idx=obj.formId.indexOf($(this).attr('href').slice(1));
		showVal=st.liShow[idx];
		st.liShow[idx]=!showVal;
		st.divShow[idx]=!showVal;
	}
	if(type=='div'){
		idx=obj.formId.indexOf($(this).data('target').slice(1));
		st.liShow[idx]=false;
		st.divShow[idx]=false;
	}
	st.trigger.type=type;
	st.trigger.index=idx;
		
	obj.setStatus(st).setCollapse();
});

</script>