<!-- //module:asset, view:index/index.html  -->


<ul id="assPeriodNav" class="nav nav-pills">
	<!-- //jQ生成 -->
</ul>
<h4 id="assTitle" class="text-left">
	<!-- //jQ生成 -->
</h4>
<div id="divSearchBtn" class="text-right">
	<div class="btn-group">
    	<button id="btnSearchFormCollapse" type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-collapse-switch="main" data-collapse-multiple=true title="显示/隐藏搜索条件">搜索条件</button>
			
    	<div class="btn-group">
			<button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">更多<span class="caret"></span></button>
      		<ul class="dropdown-menu" role="menu">
				<li class=""><a href="#divSearchForm" data-toggle="collapse" data-collapse-switch="li" title="根据输入信息搜索"><span class="glyphicon glyphicon-edit"></span>一般搜索</a></li>
    			<li role="separator" class="divider"></li>
    			<li class=""><a href="#divSearchFormBarcode" data-toggle="collapse" data-collapse-switch="li" title="选择/ 拍摄<br>条形码图片搜索"><span class="glyphicon glyphicon-barcode"></span>条形码搜索</a></li>
      		</ul>
    	</div>
  	</div>
		
	<button id="btnRefresh" type="button" class="btn btn-primary btn-sm" title="刷新列表"><span class="glyphicon glyphicon-refresh"></span>刷新</button>
</div>


<!-- // 一般搜索区域-->
<div id="divSearchForm" class="collapse">
	<br>
	<span class="text-primary" ><span class="glyphicon glyphicon-edit"></span>一般搜索条件</span>
	
	<button type="button" class="close" data-target="#divSearchForm"  data-toggle="collapse" data-collapse-switch="div" title="关闭">&times;</button>
	<!-- // 搜索表单-->
	<div id="searchForm">
	<!-- //jQ生成 -->
	</div>
</div>
	
<!-- // 条形码搜索区域-->
<div id="divSearchFormBarcode" class="collapse">
	<br>
	<span class="text-primary" ><span class="glyphicon glyphicon-barcode"></span>条形码搜索</span>
	
	<button type="button" class="close" data-target="#divSearchFormBarcode" data-toggle="collapse" data-collapse-switch="div" title="关闭">&times;</button>
		
	<!-- <div id="divBarcodeArea_load"><p class="text-center" style="font-size:20px;">加载中……</p></div> -->
	{include file="../application/common/decodeBarcode.html"}
</div>
	
<div id="searchNum">
	<p class="text-right bingo" style="padding-top:10px;"><button class="btn btn-info btn-sm" style="cursor:unset;font-size:14px;">搜索结果：<span class="badge"></span></button>
	</p>
		
	<p class="text-center none" style="padding-top:20px;"><strong>搜索结果</strong>：<span class="label label-default" style="font-size:16px;">无符合条件信息</span></p>
</div>
	
<div class="tab-content">
	<div id="assList">
	<!-- //jQ载入 -->
		<p class="text-center" style="font-size:20px;">加载中……</p>
	</div>
</div>	

<!-- Modal "modalAssSingle" -->
<div class="modal fade" id="modalAssSingle" role="dialog">
	<div class="modal-dialog modal-lg">
    
      <!-- Modal content-->
      	<div class="modal-content">
        <div class="modal-header bg-info" style="border-radius:5px;">
          	<button type="button" class="close" data-dismiss="modal">&times;</button>
		  
          	<h4 class="title"></h4>
        </div>
		
        <div class="modal-body">
			<!-- // 单个asset增删改查页面显示位置，需load其他模板文件的div-->
			<div id="divLoadAssSingle">
				<p class="text-center" style="font-size:28px;">加载中……</p>
			</div>
		</div>
		
		<div class="modal-footer">
        	<input type="button" class="btn btn-primary btn-sm" data-dismiss="modal" value="关闭"> 
        </div>
		</div>
	</div>

</div>

<!--/ Modal "modalAssSingle" -->

<script>
rqData.sortData.sortName='{$sortName}';

initPage();	

var collapseSwitchSet=$('[data-collapse-switch]'),
	collapseSwitchA=$('[data-collapse-switch="li"]'),
	collapseSwitchBtn=$('[data-collapse-switch="div"]');
	
//searchFormCollapse类
var searchFormCollapse=function(){
	//要求liSet.length==divSet.length
	var divSet=$('[data-collapse-switch="div"]').parent();
	var liSet=$('[data-collapse-switch="li"]').parent();
	
	//自调用匿名函数立即执行，进行赋值
	var formId=(function(){
			let arr=[];
			divSet.each(function(index){
				arr[index]=$(this).attr('id');
			});
			return arr;
		}());
	var zArr=()=>{	
			let arr=Array(formId.length).fill(false);
			return arr;	
		};
	var totalTrue=(acc,cur)=>{
			if(cur){
				acc++;
			}
			return acc;
		};
	var prop={liShow:'active',divShow:'in',fn:{show:'show',hide:'hide'}};
	var status={trigger:{type:'',index:'',multiple:false},showIndex:zArr()};
	
	var getStatus=()=>{
		let idx='';
		divSet.each(function(){
			idx=formId.indexOf($(this).attr('id'));
			//jQ中的hasClass()方法不起作用？
			<!-- $(this).hasClass(prop.divShow)?status.showIndex[idx]=true:status.showIndex[idx]=false; -->
		
			$(this).attr('class').indexOf(prop.divShow)!=-1?status.showIndex[idx]=true:status.showIndex[idx]=false;
		});
		
		return status;
	};
	
	var reset=()=>{
		st={trigger:{type:'main',index:'0',multiple:''},showIndex:zArr()};
		st=setCollapse(st);
		consoleColor('reset():');
		console.table(st);
	};
	
	var setStatus=(opt={})=>{
		let type='',
			idx='',
			showVal='';
		
		status =$.extend({},status,opt);	
		type=status.trigger.type;
		idx=status.trigger.index;
		
		if(status.trigger.multiple==false){
			return setStatusSingle();
		}

		if(type=='main'){
			<!-- status.showIndex.reduce(totalTrue,0)?status.showIndex=zArr():status.showIndex[0]=true; -->
			if(idx === ''){
				status.showIndex=zArr();
				<!-- status.trigger.index=0; -->
				status.trigger.index=[0];
				status.showIndex[0]=true;
			}
			
			if(Array.isArray(idx)){
				showVal=status.showIndex[idx];
				status.showIndex=zArr();
				status.showIndex[idx]=!showVal;
			}
			
			if(idx === 'all'){
				status.showIndex.forEach(function(v,i){
					status.showIndex[i]=!v;
				});
			}
			if(idx !== '' && idx !== 'all'){
				showVal=status.showIndex[idx];
				status.showIndex=zArr();
				status.showIndex[idx]=!showVal;
			}
			
		}
		if(type=='li'){
			showVal=status.showIndex[idx];
			status.showIndex[idx]=!showVal;
			<!-- if(status.showIndex.reduce(totalTrue,0)==status.showIndex.length){ -->
				<!-- status.trigger.index='all'; -->
			<!-- } -->
		}
		if(type=='div'){
			status.showIndex[idx]=false;
		}
		
		consoleColor('setStatus():');
		console.table(status);
		
		return status;
	};
	//根据status对有关组件进行显示、隐藏
	var setCollapse=(opt={})=>{
		
		setStatus(opt);
		
		status.showIndex.forEach(function(v,i){
			if(v){
				divSet.eq(i).collapse(prop.fn.show);
				liSet.eq(i).addClass(prop.liShow);
			}else{
				divSet.eq(i).collapse(prop.fn.hide);
				liSet.eq(i).removeClass(prop.liShow);
			}
		});
		consoleColor('setCollapse():');
		console.table(status);		
		return status;
	};
	//只能显示一个searchForm及其对应组件
	var setStatusSingle=()=>{
		let type=status.trigger.type,
			idx=status.trigger.index,
			showVal='';;
		
		<!-- consoleColor('toggle():'); -->
		<!-- console.log(idx);	 -->

		//只有showIndex[idx]的值有改变，其他的都为false	
		if(type=='li'){
			showVal=status.showIndex[idx];
			status.showIndex=zArr();
			status.showIndex[idx]=!showVal;
		}
		if(type=='main'){
			if(idx === ''){
				status.showIndex=zArr();
				status.trigger.index=0;
				status.showIndex[0]=true;
			}
			if((typeof idx) == 'number'){
				showVal=status.showIndex[idx];
				status.showIndex=zArr();
				status.showIndex[idx]=!showVal;
			}
		}
		if(type=='div'){
			status.showIndex[idx]=false;
		}
		return status;
	};
	
	return {
		formId:formId,
		//自调用匿名函数立即执行
		zArr:(function(){let arr=zArr(); return arr;}()),
		status:status,
		//返回本对象，实现链式操作。
		<!-- setStatus:function(opt){ setStatus(opt); return this;}, -->
		setCollapse:function(opt){return setCollapse(opt);},
		reset:function(){return reset();}
	}
};

$(document).ready(function(){
//实例化对象
let sFCObj=searchFormCollapse(),
	fmId=sFCObj.formId,
	trgObj=sFCObj.status.trigger;

<!-- //点击nav中的各个按钮后，loadEntPeriodList()-->
$('#entPeriod').children('ul.nav').find('a').click(function(){	
	//排序、分页有关的值向sortData汇集
	rqData.period=$(this).data('period');
	rqData.sortData.pageNum=1;
	buildPeriodTitleCom();
	loadEntPeriodList();
});	

<!-- // 页面刷新 -->
$('#btnRefresh').click(function(){
	//隐藏搜索条件
	<!-- $('#divSearchForm').removeClass('in'); -->
	resetSearchForm();
	sFCObj.reset();
	<!-- console.table(sFCObj.status);  -->
	consoleColor($('.searchForm').length);
});	

<!-- console.log(searchFormCollapse().status);	 -->

//3类共5个collapse-switch组件的click事件处理函数，
//任意时刻只有一个组件能click。记录触发click的组件特征值，再由特征值决定组件的显示
collapseSwitchSet.click(function(){
	//特征值1
	let	type=$(this).data('collapseSwitch');
	//特征值2
	let	idx='';
	//特征值3
	let	mul=$('[data-collapse-switch="main"]').data('collapseMultiple');
	
	let st='';
	let n='';
	let showArr=sFCObj.status.showIndex;
	let totalTrue=(acc,cur)=>{
			if(cur){
				acc++;
			}
			return acc;
		};
	
	if(mul){
		idx=[];
	}
	
	if(type=='li'){
		n=fmId.indexOf($(this).attr('href').slice(1));
		Array.isArray(idx)?idx.push(n):idx=n;
	}
	if(type=='div'){
		n=fmId.indexOf($(this).data('target').slice(1));
		Array.isArray(idx)?idx.push(n):idx=n;
	}
	if(type=='main'){
		n=trgObj.index;
		Array.isArray(idx)?idx.push(n):idx=n;
	}	
	
	trgObj.type=type;
	trgObj.index=idx;
	trgObj.multiple=mul;
	
	consoleColor(type+' ,'+idx+' click, '+'status.trigger:','red');	
	console.log(trgObj);
	console.log(trgObj.index);
	
	st=sFCObj.setCollapse({trigger:trgObj});
	
	consoleColor('调用sFCObj的setCollapse()后的status：','blue');
	console.table(st); 
	
});
});
</script>