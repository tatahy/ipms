<!-- // total.html  -->
<div id="divTotal" class="tab-pane">
	
	<h4 id="h4PatType" class="text-left">
	
		<span class="pull-right">
			<button id="btnSearchInfo" type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#divCollapse" title="显示/隐藏专利搜索条件"><span class="glyphicon glyphicon-plus"></span>搜索</button>&nbsp;
			<button id="btnRefresh" type="button" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-refresh"></span>刷新</button>
		</span>
	</h4>

	<!-- // 搜索区域，仅“专利总数”页面显示 -->
	<div id="divCollapse" class="collapse" style="padding-top:10px;">
		<a class="label label-primary" style="font-size:14px;border-bottom-left-radius:0px;border-bottom-right-radius:0px;" href="#divCollapse"  data-toggle="collapse" title="点击隐藏">专利查询条件</a>
		
		<form method="" action="" id="fmPatSearch" style="border:1px solid #eee;padding:10px 0px;">
			<div class="row myRow">
				<div class="form-group col-sm-4">
					<label class="" for="topic">名称</label>
					<input class="form-control" name="topic" type="text" value="" placeholder="...不限">
				</div>
				<div class="form-group col-sm-2">
					<label class="control-label" for="author">撰写人</label>
					<input class="form-control" name="author" type="text" value="" placeholder="...不限">
				</div>
				
			</div>
			<div class="row myRow">
				<div class="form-group col-sm-5">
					<label class="control-label" for="type">类型</label>
					<!-- <select multiple class="form-control" id="searchPatType" name="searchPatType" > -->
					<select class="form-control" name="type" >
						<option value="0">...不限</option>
					</select>
				</div>
				<div class="form-group col-sm-4">
					<label class="control-label" for="dept">部门</label>
					<!-- <select multiple class="form-control" id="searchDept" name="searchDept"> -->
					<select class="form-control" name="dept">
						<option value="0">...不限</option>
					</select>
				</div>					
				<div class="form-group col-sm-3">
					<label class="control-label" for="status">状态</label>
					<!-- <select multiple class="form-control" id="searchPatStatus" name="searchPatStatus"> -->
					<select class="form-control" name="status">
						<option value="0">...不限</option>	
					</select>
				</div>
			</div>
			<div class="row myRow text-right">	
				<button id="btnSearchPat" type="button" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-search"></span>搜索</button>	
				<button type="reset" class="btn btn-primary btn-sm">条件重置</button>
			</div>					
		</form>
			
	</div>
	
	{neq name="numTotal" value="0"}
	<div class="row myRow">
		<p></p>
		<div class="text-right">
			<strong class="assType"></strong><span id="spSearchResult" class="label label-info">列表记录总数</span>：<span class="badge">{$numTotal}</span></span>
		</div>
		<p></p>
	</div>
	{/neq}
	
	<!-- // PatList表格排序信息汇总组件 -->
	<div id="divTblSortData" data-sort-name="{$sortData.sortName}" data-sort-order="{$sortData.sortOrder}" data-list-rows="{$sortData.listRows}" data-page-num="{$sortData.pageNum}" data-show-id="{$sortData.showId}" data-period="{$sortData.period}" class="sr-only"></div>
	
	<div class="table-responsive">
		<table id="tblPatList" class="table table-bordered table-striped table-hover">
			<caption class="text-center" style="border-bottom:1px solid #eee;"><h4>专利信息列表&nbsp;<strong class="assType"></strong></h4></caption>
			<thead>
				<tr>
					<th>序号</th>
					<th><a data-sort-name="topic">名称</a></th>
					<th><a data-sort-name="type">类型</a></th>
					<th><a data-sort-name="status">状态</a></th>
					<th><a data-sort-name="submitdate">提交日期</a></th>
					
					<th><a data-sort-name="author">撰写人</a></th>
					<th><a data-sort-name="inventor">发明人</a></th>
					<th><a data-sort-name="patowner">所有人</a></th>
					
					<th><a data-sort-name="dept">所属部门</a></th>
					<th><a data-sort-name="pronum">关联项目</a></th>
				</tr>
			</thead>
			<tbody><!-- 此处显示数据库查询后的数据集 -->
				{volist name="patList" id="vo" empty="暂时没有数据"}
				<tr>
					<td>{$i+($sortData.pageNum-1)*$sortData.listRows}</a></td>
					<td class="patInfo"><a href="{$home}/patent/index/patinfo/id/{$vo.id}" target="_blank" data-toggle="tooltip">{$vo.topic}</a></td>
					{// patent模块的Model层对‘pattype’字段输出值有处理，用getData方法可以得到‘type’字段在数据库中的值}
					<!-- <td>{$vo->getData('type')}</td> -->
					<td>{$vo.type}</td>
					<td>{$vo.status}</td>
					<td>{$vo.submitdate}</td>
					
					<td>{$vo.author}</td>
					<td>{$vo.inventor}</td>
					<td>{$vo.patowner}</td>
					
					<td>{$vo.dept}</td>
					<td class="proInfo">
						{foreach $vo.pronum as $num} 
							{if $num eq '无'}
								无
							{else /}
								<a href="#" data-toggle="tooltip">{$num}</a>
							{/if}
						{/foreach}
					</td>
				</tr>
				{/volist}
			</tbody>
		</table>
	</div>
	
	<div id="divListRows" class="row text-right">
		<!-- // 分页变量 -->
		<div class="col-sm-10 text-right">{$pageSet->render()}</div>
						
		<div class="form-group form-group-sm col-sm-2">
			<span class="">每页记录行数：</span>
				<select class="form-control" id="listRows">
					<option value="5">5</option>
					<option value="10">10</option>
					<option value="20">20</option>
					<option value="50">50</option>
				</select>
						
		</div>
	</div>
			
</div>

<script>
// 本页面的pat所处的阶段
<!-- var period='{ $sortData}'; -->
var numTotal={$numTotal};

// 根据本页面的锚点值，决定<h4>的内容
var setTitle=()=>{
	let sId=window.location.hash,
		lab='',
		txt='',
		spObj=$('<span></span>').css('padding','6px'),
		spBdg=$('<span></span>').addClass('badge'),
		hObj=$('#h4PatType');
		
	switch(sId){
		case'#audit':
			lab='label label-default';
			txt='内部审核拟申报专利&nbsp;';
			spBdg.text(numTotal);
			break;
		case'#newAdd':
			lab='label label-info';
			txt='拟申报专利';
			break;
		case'#apply':
			lab='label label-primary';
			txt='申报专利';
			break;
		case'#authorize':
			lab='label label-success';
			txt='授权（有效期）专利';
			break;	
		case'#render':
			lab='label label-success';
			txt='续费授权（有效期）专利';
			break;
		case'#abandon':
			lab='label label-info';
			txt='已放弃专利数&nbsp;';
			spBdg.text(numTotal);
			break;
		case'#reject':
			lab='label label-info';
			txt='被驳回专利数&nbsp;';
			spBdg.text(numTotal);
			break;
		case'#invalid':
			lab='label label-default';
			txt='无效专利数&nbsp;';
			spBdg.text(numTotal);
			break;
		default:
			lab='label label-default';
			txt='专利总数&nbsp;';
			spBdg.text(numTotal);
			break;		
	}
	spObj.addClass(lab).append(txt,spBdg);
	hObj.prepend(spObj);
};
//对选定的patList列表字段进行升序降序转换，改变该字段表头显示格式
var sortOrderToggle=()=>{
	let obj='',
		glyAsc='&nbsp;<span class="small glyphicon glyphicon-sort-by-attributes"></span>',
		glyDesc='&nbsp;<span class="small glyphicon glyphicon-sort-by-order-alt"></span>',
		sortOrder=$('#divTblSortData').data('sortOrder'),
		sortName=$('#divTblSortData').data('sortName');
		
	$('#tblPatList thead a').removeClass('label label-primary');
	
	$('#tblPatList thead a').each(function(){
		if(sortName==$(this).data('sortName')){
			obj=$(this);
		}else{
			$(this).tooltip({placement: 'bottom'});
		}
	});
	
	if(obj.length){
		obj.addClass('label label-primary');
		if(sortOrder == 'asc'){
			//当前为升序
			obj.append(glyAsc).data('sortOrder','desc').tooltip({title:'当前为升序。点击后降序',placement: 'top'});
		}else{
			//当前为降序
			obj.append(glyDesc).data('sortOrder','asc').tooltip({title:'当前为降序。点击后升序',placement: 'top'});
		}
	}		
};
//完善搜索表单的select组件内容
var setFmSelectCom=(fmObj)=>{
	let selSet=fmObj.find('select'),
		selName=[],
		url='getSelComData',
		period=$('#divTblSortData').data('period');
	//发送给后端的与select组件有关的变量
	let selData={period:period};	
	//查询表单中选择框的name属性值数组
	for(var i=0;i<selSet.length;i++){
		selName[i]=selSet.eq(i).attr('name');
	}
	
	selData=$.extend(selData,{nameArr:selName});
	//向后端请求组装select组件所需数据
	$.post(url,selData,function(resData){
		//挨个组装好所有的select组件
		for(var i=0;i<selSet.length;i++){
			let selObj=selSet.eq(i),
				selName=selObj.attr('name');
			selObj.empty().append($('<option></option>').val(0).text('…不限'));		
			//组装option
			resData.forEach(function(item){
				let name=item.name,
					keyArr=item.key,
					valueArr=item.value;
					
				while(selName==name){
					if(selName=='dept'){
						valueArr.forEach(function(itmChi,index){
							selObj.append($('<option></option>').val(itmChi).	text(itmChi +'，简称：'+keyArr[index]));
						});
					}else{
						keyArr.forEach(function(v,k){
							selObj.append($('<option></option>').val(v).text(valueArr[k]));
						});
					}
				 //破坏循环执行条件，跳出循环。否则循环无限执行 -->
				<!-- selName=0; -->
				//直接跳出循环
					break;
				}
			});
		}
	});
	
};
//设定搜索表单的各项内容
var setFmSearchData=(optObj)=>{
	let fcSet=$('#fmPatSearch').find('.form-control'),
		keyArr=Object.keys(optObj),
		valArr=Object.values(optObj);
	
	keyArr.forEach(function(item,index){
		for(var i=0;i<fcSet.length;i++){
			let subCom=fcSet.eq(i),
				name=subCom.attr('name');
			while(item==name){
				<!-- console.log(typeof valArr[index]); -->
				//valArr[index]是否为数组
				if(typeof valArr[index] == 'Object'){
					valArr[index].forEach(function(v,k){
						subCom.val(v);
						console.log(v);	
					});
				}else{
					subCom.val(valArr[index]);
				}
				break;
			}
		}
		<!-- console.log(item,valArr[index]);	 -->
	});
	
};
//载入文件
var loadTotal=()=>{
	let url='total',
		listData={sortData:{},searchData:{}},
		loadStr='<p class="text-center" style="font-size:28px;">加载中……</p>';
	//排序有关的参数都从$('#divTblSortData')获取
	let obj=$('#divTblSortData'),
		sortData={
			'sortName':obj.data('sortName'),
			'sortOrder':obj.data('sortOrder'),
			'pageNum':obj.data('pageNum'),
			'listRows':obj.data('listRows'),
			'showIssId':obj.data('showIssId')
		},
		sortDataDefault={'listRows':10,'sortName':'issnum','sortOrder':'asc','pageNum':1,'issEntName':'_PAT','showIssId':0,'issStatus':'_INPROCESS'};
	
	
	//用户搜索有关键值对从表单$('#fmIssPatSearch')获取
	let formData=new FormData($('#fmPatSearch')[0]),
		searchData={};
	
	//使用Map对象的forEach方法组装键值对
	formData.forEach(function(val,key){
		//非0非空的值才进行组装
		if(val!='' && val!=0){
			searchData[key]=val;
		}
	});
	
	<!-- // 转换成json字符串-->
	JSON.stringify(searchData);
	
	sortData=$.extend({},sortDataDefault,sortData);
	listData.sortData=sortData;
	listData.searchData=searchData;
	
	//加载total.html页面内容到patlist.html页面中<div id="patlist"></div>
	$("#patlist").html(loadStr).load(url,listData);
};

//利用自调用匿名函数立即执行的特点，页面初始化
(function($){
	
	//每个$('#tblIssList thead a')添加属性
	$('#tblPatList thead a').attr({'href':window.location.hash,'data-title':'点击排序','data-toggle':'tooltip'}).closest('th').addClass('text-center');
	setTitle();
	setFmSelectCom($('#fmIssSearch'));
	
	if(Object.keys(searchData.length)){
		setFmSearchData($('#fmIssSearch'),searchData);
	}
	sortOrderToggle();
	// 激活tooltip
	$('[title]').tooltip();	
})(jQuery);

$(document).ready(function(){
		
	$("#btnSearchPat").click(function(){
		<!-- //根据每页显示记录行数加载页面 -->
		loadTotal($("#totalTableRows").val());
	});
	
	<!-- // 本文件重新加载到palist.html的指定区域<div id="patlist"></div> -->
	$("#btnRefresh").click(function(){
		$("#patlist").load("total");
	});
	
	//排序
	$('#tblPatList thead a').click(function(){
		let sortName=$(this).data('sortName');
		//排序有关的值向$('#divTblSortData')汇集
		$('#divTblSortData').data('sortName',sortName);
		$('#divTblSortData').data('pageNum',1);
		
		<!-- //根据每页显示记录行数，pat状态，排序字段，排序方式加载页面 -->
		loadTotal($("#totalTableRows").val(),patStatus,sortName,sort);
		
	});

	<!-- //表格每页显示记录行数 -->
	$('#listRows').val('{$sortData.listRows}'); 
	
	$('#listRows').change(function(){
		let listRows=$(this).val()*1;
		//排序有关的值向$('#divTblSortData')汇集
		if(listRows){
			$('#divTblSortData').data('listRows',listRows);
			//分页从第一页开始
			$('#divTblSortData').data('pageNum',1);
		}
		
		loadTotal();
	
	});	
	
	<!-- // 点击分页中的a，表格中的内容根据a中的属性值进行排序 -->
	$('#divListRows a').click(function(event){
		// a所在分页页数
		let pageStr=$(this).text(),pageNum,
		//(li.active)所代表的页数
			pageNumActive=$('#divListRows li.active').children('span').text(),
			sortName=$('thead').find('.label').data('sortName');
		
        event.preventDefault();
		<!-- alert("pageStr:"+pageStr+" active:"+pageNumActive); -->
		
		switch(pageStr){
			case'»':
				//用"*"确保得到的是加法运算结果，而不是字符串
				pageNum=(pageNumActive*1+1);
			break;
			
			case'«':
				pageNum=(pageNumActive*1-1);
			break;
			
			default:
				pageNum=pageStr*1;
			break;
		
		}
		//排序有关的值向$('#divTblSortData')汇集
		if(pageNum){
			$('#divTblSortData').data('pageNum',pageNum);
		}
		
		<!-- //根据每页显示记录行数，排序字段，排序方式，分页页数加载页面 -->
		loadTotal();
	
	});


<!-- function -->
	
	
<!-- function -->
	
	
});
</script>