<!-- // patList.html  -->

<div id="searchNum">
	<p class="text-right bingo" style="padding-top:10px;"><button class="btn btn-info btn-sm" style="cursor:unset;font-size:14px;">搜索结果：<span class="badge">{$numTotal}</span></button>
	</p>
		
	<p class="text-center none" style="padding-top:20px;"><strong>搜索结果</strong>：<span class="label label-default" style="font-size:16px;">无符合条件信息</span></p>
</div>

<div id="searchList" style="padding-top:10px;">	
	<div class="table-responsive">
		<table id="tblPatList" class="table table-bordered table-hover">
			<caption class="text-center" style="border-bottom:1px solid #eee;"><h4>专利信息列表&nbsp;<strong class="assType"></strong></h4></caption>
			<thead>
				<tr>
					<th class="text-center">序号</th>
					<th><a data-sort-name="topic">名称</a></th>
					<th><a data-sort-name="type">类型</a></th>
					<th><a data-sort-name="status">状态</a></th>
					<th><a data-sort-name="submitdate">提交日期</a></th>
					
					<th><a data-sort-name="author">撰写人</a></th>
					<th><a data-sort-name="inventor">发明人</a></th>
					<th><a data-sort-name="patowner">所有人</a></th>
					
					<th><a data-sort-name="dept">所属部门</a></th>
					<th><a data-sort-name="pronum">关联项目</a></th>
				</tr>
			</thead>
			<tbody><!-- 此处显示数据库查询后的数据集 -->
				{volist name="patList" id="vo" empty="暂时没有数据"}
				<tr data-show-id="{$vo.id}" class="text-right">
					<td class="text-center">{$i+($sortData.pageNum-1)*$sortData.listRows}</a></td>
					<td class="patInfo"><a href="{$home}/patent/index/patinfo/id/{$vo.id}" target="_blank" title="专利详情">{$vo.topic}</a></td>
					{// patent模块的Model层对‘pattype’字段输出值有处理，用getData方法可以得到‘type’字段在数据库中的值}
					<!-- <td>{$vo->getData('type')}</td> -->
					<td>{$vo.type}</td>
					<td>{$vo.status}</td>
					<td>{$vo.submitdate}</td>
					
					<td>{$vo.author}</td>
					<td>{$vo.inventor}</td>
					<td>{$vo.patowner}</td>
					
					<td>{$vo.dept}</td>
					<td class="proInfo">
						{foreach $vo.pronum as $num} 
							{if $num eq '无'}
								无
							{else /}
								<a href="#" data-toggle="tooltip">{$num}</a>
							{/if}
						{/foreach}
					</td>
				</tr>
				{/volist}
			</tbody>
		</table>		
	</div>
	
	<div id="divListRows" class="row text-right">
		<!-- // 分页变量 -->
		<div class="col-sm-10 text-right">{$pageSet->render()}</div>
						
		<div class="form-group form-group-sm col-sm-2">
			<span class="">每页记录行数：</span>
				<select class="form-control" id="listRows">
					<option value="5">5</option>
					<option value="10">10</option>
					<option value="20">20</option>
					<option value="50">50</option>
				</select>
						
		</div>
	</div>
</div>

<script>
var sData={$searchData};
var num={$numTotal};
<!-- console.log('patList.html'); -->
<!-- console.table(sData); -->

//对PatList进行设置
//列表字段进行升序降序转换，改变该字段表头显示格式
var setSortList=()=>{
	let glyAsc=$('<span></span>').addClass('small glyphicon glyphicon-sort-by-attributes'),
		glyDesc=$('<span></span>').addClass('small glyphicon glyphicon-sort-by-order-alt'),
		sortOrder=$('#divTblSortData').data('sortOrder'),
		sortName=$('#divTblSortData').data('sortName'),
		tblObj=$('#tblPatList'),
		aHSet=tblObj.find('thead a'),
		trSet=tblObj.find('tr'),
		column='',
		columnArr=['num'];
		
	aHSet.each(function(){
		let gly=(sortOrder == 'asc')?glyAsc:glyDesc,
			sort=(sortOrder == 'asc')?'desc':'asc',
			title=(sortOrder == 'asc')?'当前为升序。点击后降序':'当前为降序。点击后升序',
			column=$(this).data('sortName');
		columnArr.push(column);
		//每个添加属性
		$(this).removeClass('label label-primary').attr({'href':window.location.hash,'title':'点击排序'}).closest('th').addClass('text-center');
		
		(sortName==column)?$(this).tooltip({placement: 'top'}).attr({'class':'label label-primary','title':title,'data-sort-order':sort}).append('&nbsp;',gly):$(this).tooltip({placement: 'bottom'});	
		
	});
	//每个单元格添加data-column=""，相同的data-column用于组合成一个column
	columnArr.forEach(function(el,index){
		trSet.each(function(){ 
			$(this).children().eq(index).attr('data-column',el);
		});	
	});
		
	//选中进行排序的列(除标题行外的)向左对齐，添加底色
	tblObj.find('tbody [data-column="'+sortName+'"]').addClass('text-left bg-info');
};

var trAddBgColor=(showId='')=>{
	let id=showId?showId:$('#divTblSortData').data('showId'),
		obj=$('#tblPatList tbody');
	//去掉所有行的底色
	obj.find('tr').removeClass('bg-warning');
	//给showId所在行上底色
	obj.find('[data-show-id="'+id+'"]').addClass('bg-warning');
};
//显示搜索结果
var showSearchResult=()=>{
	let n=0,
		fmObj=$('#divCollapse'),
		bingoObj=$('#searchNum p.bingo'),
		noneObj=$('#searchNum p.none'),
		listObj=$('#searchList');
	
	for(let el in sData){
		n=(sData[el]=='' || sData[el]==0)?n:n+1;
	}
	//是否显示搜索表单
	n?fmObj.addClass('in'):fmObj.removeClass('in');
	
	//搜索结果显示
	bingoObj.hide();
	noneObj.hide();
	listObj.hide();
	if(n==0) listObj.show();
	if(n && num){
		bingoObj.show();
		listObj.show();
	}
	if(n && num==0)	noneObj.show();
	
};

var initPatList=()=>{
	
	setSortList();
	trAddBgColor();
	showSearchResult();
	
};
//自调用匿名函数立即执行的特点，进行页面初始化。
(function($){
	initPatList();
	
	// 激活tooltip
	$('[title]').tooltip();	
})(jQuery);

$(document).ready(function(){
	
	<!-- //表格每页显示记录行数 -->
	$('#listRows').val('{$sortData.listRows}'); 
	
	$('#listRows').change(function(){
		let listRows=$(this).val()*1;
		//排序有关的值向$('#divTblSortData')汇集
		if(listRows){
			$('#divTblSortData').data('listRows',listRows);
			//分页从第一页开始
			$('#divTblSortData').data('pageNum',1);
		}
		//载入patList
		loadPatList();
	});	
	//排序
	$('#tblPatList thead a').click(function(){
		let sortName=$(this).data('sortName'),
			sortOrder=$(this).data('sortOrder');
		//排序有关的值向$('#divTblSortData')汇集
		$('#divTblSortData').data('sortName',sortName);
		$('#divTblSortData').data('sortOrder',sortOrder);
		$('#divTblSortData').data('pageNum',1);
		//载入patList
		loadPatList();
	});	
	<!-- // 点击分页中的a，表格中的内容根据a中的属性值进行排序 -->
	$('#divListRows a').click(function(evt){
		// a所在分页页数
		let pageStr=$(this).text(),pageNum,
		//(li.active)所代表的页数
			pageNumActive=$('#divListRows li.active').children('span').text(),
			sortName=$('thead').find('.label').data('sortName');

		evt.preventDefault();
		
		switch(pageStr){
			case'»':
				//用"*"确保得到的是加法运算结果，而不是字符串
				pageNum=(pageNumActive*1+1);
			break;
			
			case'«':
				pageNum=(pageNumActive*1-1);
			break;
			
			default:
				pageNum=pageStr*1;
			break;
		}
		//排序、分页有关的值向$('#divTblSortData')汇集
		if(pageNum){
			$('#divTblSortData').data('pageNum',pageNum);
		}
		//载入patList
		loadPatList();
	});
	//点击a后该行上底色
	$('#tblPatList tbody a').click(function(){
		$('#divTblSortData').data('showId',$(this).closest('tr').data('showId'));
		trAddBgColor();
	});
	
<!-- function  -->


<!-- /function  -->
	
});
</script>


