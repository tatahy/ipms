{include file="../application/common/header.html" title="专利信息" }

<!-- pagewrap  -->
<div class="mainFrame container-fluid">

	<ul class="nav nav-pills" style="border-bottom:1px solid #ddd;">
		<!-- //js生成 -->
	</ul>
	<h4 id="period" class="text-left">
		<!-- //js生成 -->
	</h4>
	<div class="text-right">
		<button type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#divCollapse" title="显示/隐藏专利搜索条件">搜索条件</button>&nbsp;
		<button id="btnRefresh" type="button" class="btn btn-primary btn-sm" title="刷新页面"><span class="glyphicon glyphicon-refresh"></span>刷新</button>
	</div>
	
	<div id="divCollapse" class="collapse" style="padding-top:10px;">
		<a class="label label-primary" style="font-size:14px;border-bottom-left-radius:0px;border-bottom-right-radius:0px;padding-top:5px;" href="#divCollapse"  data-toggle="collapse" title="点击隐藏">专利搜索条件</a>
		<!-- // 搜索表单-->
		<div id="patSearchForm">
		<!-- //js生成 -->
		</div>
	</div>
	
	<div class="tab-content">
		<!-- // PatList表格排序信息汇总组件 -->
		<div id="divTblSortData" data-sort-name="{$sortData.sortName}" data-sort-order="{$sortData.sortOrder}" data-list-rows="{$sortData.listRows}" data-page-num="{$sortData.pageNum}" data-show-id="{$sortData.showId}" data-period="{$sortData.period}" class="sr-only"></div>
		
		<div id="patList">
		<!-- //js生成 -->
		</div>
	</div>
	
<!-- </div> -->
</div>
<!-- /pagewrap  -->

<script>
const periodProp={$periodProp};
console.log(periodProp);

//定义要加载的搜索表单中各个输入组件属性值
const searchFormComProp={
	topic:{name:'topic',tag:'input',val:''},
	author:{name:'author',tag:'input',val:''},
	type:{name:'type',tag:'select',val:0},
	dept:{name:'dept',tag:'select',val:0},
	status:{name:'status',tag:'select',val:0},
};
//定义title属性值
const titleProp=[
	{period:'total',lab:'label label-primary',btn:'btn btn-primary',txt:'专利总数&nbsp;'},
	{period:'audit',lab:'label label-info',btn:'btn btn-info',txt:'内部审核拟申报专利&nbsp;'},
	{period:'newAdd',lab:'label label-info',btn:'btn btn-info',txt:'拟申报专利&nbsp;'},
	{period:'apply',lab:'label label-primary',btn:'btn btn-primary',txt:'申报专利&nbsp;'},
	{period:'authorize',lab:'label label-success',btn:'btn btn-success',txt:'授权(有效期)专利&nbsp;'},
	{period:'render',lab:'label label-success',btn:'btn btn-success',txt:'续费授权(有效期)专利&nbsp;'},
	{period:'abandon',lab:'label label-info',btn:'btn btn-info',txt:'已放弃专利数&nbsp;'},
	{period:'reject',lab:'label label-info',btn:'btn btn-info',txt:'被驳回专利数&nbsp;'},
	{period:'invalid',lab:'label label-default',btn:'btn btn-default',txt:'无效专利数&nbsp;'}
];

// 根据本页面的锚点值，决定setTitle的内容
var setTitle=()=>{
	let sId=window.location.hash,
		color='',
		txt='',
		spObj=$('<span></span>').css({'cursor':'unset'}),
		num='';
		spBdg=$('<span></span>').addClass('badge'),
		hObj=$('#period');
	
	for(let i=0;i<titleProp.length;i++){
		let el=titleProp[i];
		if(el.period==sId.slice(1)){
			color=el.btn;
			txt=el.txt;
			num=(typeof periodProp[el.period])?periodProp[el.period]['num']:'';
			(num)?spBdg.text(num):'';
			break;
		}
	}
	spObj.addClass(color).append(txt,spBdg);
	hObj.empty().append(spObj);
};
//生成nav-pills里的组件
var buildNavPillsCom=()=>{
	let obj=$('ul.nav-pills');
	obj.empty();	
	for(let el in periodProp){
		let num=periodProp[el]['num'],
			chi=periodProp[el]['chi'],
			aObj=$('<a></a>').addClass('aTab').css({'padding':'3px 10px','border-bottom-right-radius':'0px','border-bottom-left-radius':'0px'}),
			liObj=$('<li></li>');
		aObj.attr('href','#'+el).html(chi);
		liObj.append(aObj);
		obj.append(liObj);
	}
};

var initPage=()=>{
	let sId=window.location.hash,
		period=sId.slice(1);
	$('#divTblSortData').data('period',period);
	buildNavPillsCom();
	setTitle();
	//载入patSearchForm
	$('#patSearchForm').load('patSearchForm');
	//载入patList
	loadPatList();
};
//所有查询表单重置
var fmReset=()=>{
	let fm=$('form');
	
	fm.each(function(){
		$(this)[0].reset();
		$(this).find('.form-control').removeClass('alert-info');
	});
};

//自调用匿名函数立即执行的特点，进行页面初始化。
(function($){
	initPage();
	
	//选中id为"nav_pat"的标签（header.html文件中的li标签）,添加.active
	$('#nav_pat').addClass('active');
	// 激活tooltip
	$('[title]').tooltip();	
})(jQuery);

$(document).ready(function(){
	
	$('#nav_pat').click(function(){
		let period='total',
			sId='#'+period;
		window.location.hash=sId;
		$('#divTblSortData').data('period',period);
		$('.aTab[href="'+sId+'"]').tab('show');
		loadPatList();
	});	
	
	<!-- //点击.aTab中的各个按钮后，显示相应状态的pat内容-->
	$('.aTab').click(function(){
        let sId = $(this).attr('href'),  //a的attr属性值
			period=sId.slice(1);
		//设置锚点值
		window.location.hash=sId;
		
		//本身加底色
		$(this).tab('show');
		$('#divTblSortData').data('period',period);
		setTitle();
		
		loadPatList();
    });	
	
	$('.aTab').each(function(){
		<!-- //	为锚点值对应的li添加.active -->
		if($(this).attr('href')==window.location.hash){
			$(this).parent().addClass('active');
		}	
	});
	<!-- // 页面刷新 -->
	$('#btnRefresh').click(function(){
		//所有表单重置
		fmReset();
		//隐藏搜索条件
		$('.collapse').removeClass('in');
		loadPatList();
	});	
});
<!-- function  -->

//载入文件
function loadPatList(opt={}){
	let url='patList',
		rqData=$.extend({},{sortData:{},searchData:{}},opt),
		loadStr='<p class="text-center" style="font-size:28px;">加载中……</p>';
	//排序有关的参数都从$('#divTblSortData')获取
	let obj=$('#divTblSortData'),
		sortData={
			'sortName':obj.data('sortName'),
			'sortOrder':obj.data('sortOrder'),
			'pageNum':obj.data('pageNum'),
			'listRows':obj.data('listRows'),
			'showId':obj.data('showId'),
			'period':obj.data('period')
		},
		sortDataDefault={listRows:10,sortName:'topic',sortOrder:'asc',pageNum:1,showId:0,period:'total'};
	
	//用户搜索有关键值对从表单$('#fmIssPatSearch')获取
	let formData=new FormData($('#fmPatSearch')[0]),
		searchDataDefault={topic:'',author:'',type:0,dept:0,status:0};
		searchData={};
	
	//使用Map对象的forEach方法组装hash数组
	formData.forEach(function(val,key){
		//非0非空的值才进行组装
		if(val!='' && val!=0){
			searchData[key]=val;
		}
	});
	
	rqData.sortData=$.extend({},sortDataDefault,sortData);
	rqData.searchData=$.extend({},searchDataDefault,searchData);
	console.log('index.html, loadPatList:');
	console.table(rqData.searchData);
	
	//加载patList.html页面
	$("#patList").html(loadStr).load(url,rqData);
}

<!-- /function  -->
</script>

{include file="../application/common/footer.html"}
