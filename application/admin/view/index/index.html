<!DOCTYPE html>
<html>
<head>
	<title>系统管理</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
   
    {// TP5中的模板注释格式，单行。<!-- TP5的资源文件加载写法 -->内容不会出现在发送给浏览器的HTML文件中 }  
  {js href="/admin/res/js/jquery1.12.4.min.js" }
  {js href="/admin/res/js/bootstrap3.3.7.min.js" }
  {js href="/admin/res/js/alert.min.js" }
  {css href="/admin/res/css/bootstrap3.3.7.min.css" }
  {css href="/admin/res/css/style.css" }

{/*<!-- 实现nav固定在页面顶端效果的补充代码块,
同时还需设置nav的data-offset-top="-3"防止鼠标单击页面时出现跳动-->
*/}
<style>
.affix {
    top: 0;
    width: 100%;
}

.affix + .container-fluid {
    //padding-top: 50px;
}

body {
  /* Margin bottom by footer height */
  margin-bottom: 60px;
}

.sidenav {
    padding-top: 10px;
	height: 100%;
    width: 0px;
    position: fixed;
    z-index: 0;
    top: 50px;
    left: 0;
	border:1px solid #e3e3e3;
    background-color: #f5f5f5;
    //background-color: #f2f2f2;
    overflow: hidden;
    transition: 0.5s;
}

.sidenav.sidenav-show{
    width: 200px;
}

#divContainer {
    padding-top: 55px;
	margin-left:0px;
	position: relative;
	//z-index: 0;
	transition: margin-left 0.5s;
}

#divContainer.sidenav-show{
	margin-left:200px;
}

.sidenav-backdrop {
	z-index: 0;
}

footer {
	//border:1px solid #e3e3e3;
	background-color:#f5f5f5; 
	position: fixed;
	/* 确保footer遮盖了分页显示*/
	z-index: 9;
	bottom:0;
	width: 100%;
	/* Set the fixed height of the footer here */
	height: 60px;
  
}

@media screen and (max-width: 767px) {
.sidenav.sidenav-show {
	/* 确保遮盖footer*/
	z-index: 20;
	height: 100%;
	border-radius: 3px;
	box-shadow:0px 0px 5px 2px #aaa;
	background-color:#ffffff;
}

#divContainer.sidenav-show {
	margin-left:0px;
}
/* 产生点击层，配合js实现点击屏幕空白处隐藏sidnav*/
.sidenav-backdrop {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 10;
  background-color: transparent;
}
.sidenav a {font-size: 16px;}

footer {
	position: relative;
	background-color:#ffffff;
	border-top:1px solid #e3e3e3;
}

}
  </style>
  
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top" data-spy="affix" data-offset-top="-3">
  <div class="container-fluid">
    <div class="navbar-header" >
		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>                        
		</button>
		
      <a class="navbar-brand"><strong>IPMS</strong>系统管理</a>
	
    </div>
	
	<div class="collapse navbar-collapse" id="myNavbar">
	<ul class="nav navbar-nav navbar-right">
		
        <li><a>欢迎：<span class="glyphicon glyphicon-user"></span>【{$username}】</a></li>	
        <li id="liQuit"><a href="{$home}/admin/index/logout"><span class="glyphicon glyphicon-log-out"></span>&nbsp;退出</a></li>
      </ul>
    </div>
  </div>
</nav>
<!-- pagewrap  -->
<div id="mySidenav" class="sidenav">
	<div style="height:30px;border-bottom:1px solid #e3e3e3;"><button id="closeBtn" type="button" class="btn btn-link btn-lg pull-right" style="padding:0px 10px 0px 0px;"><span class="glyphicon glyphicon-chevron-left"></span><span style="font-size:16px;">隐藏</span></button>
	</div>
		
	<!-- //nav 与 jQuery结合实现菜单栏导航效果-->
	<ul class="nav nav-pills nav-stacked" >
		<li class="active"><a class="aTab" href="#sysSummary"><span class="glyphicon glyphicon-inbox"></span>&nbsp;系统概况</a></li>
				
		<!-- <li class="dropdown"> -->
			<!-- <a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="glyphicon glyphicon-user"></span>&nbsp;系统用户<span class="caret"></span></a> -->
			<!-- <ul class="dropdown-menu"> -->
				<!-- <li class="text-right"><a class="aTab" href="#sysUser">用户&nbsp;<span class="glyphicon glyphicon-file"></span></a></li> -->
				<!-- <li class="text-right"><a class="aTab" href="#sysUsergroup">用户组&nbsp;<span class="glyphicon glyphicon-duplicate"></span></a></li> -->
			<!-- </ul> -->
		<!-- </li> -->
		
		<li class="dropdown">
			<a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="glyphicon glyphicon-user"></span>&nbsp;系统用户管理<span class="caret"></span></a>
			<ul class="dropdown-menu">
				<li class="text-right"><a class="aTab" href="#userList">用户管理&nbsp;<span class="glyphicon glyphicon-file"></span></a></li>
				<li class="text-right"><a class="aTab" href="#usergroupList">用户组管理&nbsp;<span class="glyphicon glyphicon-duplicate"></span></a></li>
			</ul>
		</li>
				
		<li><a class="aTab" href="#sysSetting"><span class="glyphicon glyphicon-wrench"></span>&nbsp;系统设置</a></li>
	</ul>
</div>

<div id="divContainer" class="container-fluid">
	
  	<button id="openBtn" type="button" class="btn btn-link btn-lg" style="padding:0;"><span class="glyphicon glyphicon-chevron-right"></span><span style="font-size:16px;">显示</span></button>
  	
	<div id="pageParam" data-list-rows="{$pageParam.listRows}" data-page-num="{$pageParam.pageNum}" data-show-id="{$pageParam.showId}" data-url="{$pageParam.url}" class="sr-only"></div>
	
  	<div id="content" style="padding-top:5px;"><p class="text-center" style="font-size:28px;">加载中……</p></div>
	
</div>

<footer>
    <div class="text-center">
		<p style="margin-top:10px;">Powered by HY Copyright © {$year-1}-{$year}。推荐使用<a href="#">Chrome</a>、<a href="#">Firefox</a>浏览器<br>广州市光机电技术研究院（GZOME）. All rights reserved</p>
	</div>
</footer>
		
<!-- Modal "modalSingle" -->
<div class="modal fade" id="modalSingle" role="dialog" data-oprt=""> 
    <div class="modal-dialog modal-lg">

      <div class="modal-content">
        <div class="modal-header" style="border-radius: 5px 5px 0px 0px;">
          	<button type="button" class="close" data-dismiss="modal">&times;</button>
          	<h4>标题</h4>
        </div>
		
        <div class="modal-body">内容</div>
		
        <!-- <div class="modal-footer"> -->
          <!-- <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> 取消</button> -->
          
        <!-- </div> -->
      </div>
      
    </div>
</div>
<!-- / Modal "modalSingle" -->
<!-- //pagewrap  -->


<script>
<!-- 'use strict' -->
//锚点/控制台菜单名称
const archName=['#sysSummary','#userList','#usergroupList','#sysSetting'];
//归纳bootStrap3中的颜色相关属性
const bs3Color={
	//info
	info:{lab:'label label-info',btn:'btn-info',txt:'text-info',bg:'btn-info',alt:'alert-info',pan:'panel panel-info'},
	//success
	success:{lab:'label label-success',btn:'btn-success',txt:'text-success',bg:'btn-success',alt:'alert-success',pan:'panel panel-success'},
	//danger
	danger:{lab:'label label-danger',btn:'btn-danger',txt:'text-danger',bg:'btn-danger',alt:'alert-danger',pan:'panel panel-danger'},
	//warning
	warning:{lab:'label label-warning',btn:'btn-warning',txt:'text-warning',bg:'btn-warning',alt:'alert-warning',pan:'panel panel-warning'},
	//primary
	primary:{lab:'label label-primary',btn:'btn-primary',txt:'text-primary',bg:'btn-primary',pan:'panel panel-primary'},
	//default
	'default':{lab:'label label-default',btn:'btn-default'},
	//muted
	muted:{text:'text-muted'},
	//link
	link:{btn:'btn-link'}
};
//定义权限涉及的颜色属性
const authColor={
	common:{bs3:bs3Color.success,chi:'普通类'},
	important:{bs3:bs3Color.warning,chi:'重要类'},
	critical:{bs3:bs3Color.danger,chi:'关键类'}
};
//深冻结函数，递归冻结每一个属性，因Object.freeze()仅冻结第一层属性
function deepFreeze(obj){
	//第一层属性名
	var propNames=Object.getOwnPropertyNames(obj);
	//冻结自身前冻结所有属性
	propNames.forEach(function(name){
		var prop=obj[name];
		//如果是一个对象就冻结
		if(typeof prop=='object' && prop !==null)
			deepFreeze(prop);
	});
	//冻结自身
	return Object.freeze(obj);
}
//拷贝函数，递归拷贝每一个属性，针对深冻结的对象进行拷贝时，拷贝得到的对象可以修改/增加/删除属性
function copyDeepFreeze(obj,copy={}){
	//第一层属性名
	let propNames=Object.getOwnPropertyNames(obj);
	propNames.forEach(function(name){
		let prop=obj[name];
		//如果是一个对象就递归调用
		if(typeof prop=='object' && prop !==null)
			copyDeepFreeze(prop,copy[name]={});
		
		if(typeof prop!='object')
			copy[name]=prop;
	});
	return copy;
}

//权限模块核心属性，不允许修改/增加/删除属性（深冻结）
const authEntCoreProp=deepFreeze({$authEnt});
//需扩展的权限模块显示属性
const authEntViewProp={
	//ass
	ass:{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//att
	att:{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//iss-pat
	'iss-pat':{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//iss-pro
	'iss-pro':{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//iss-the
	'iss-the':{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//pat
	pat:{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//pro
	pro:{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//the
	the:{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}},
	//admin
	admin:{view:{gly:'<span class="glyphicon glyphicon-duplicate"></span>'}}
};
//扩展权限模块属性的方法
var extendAuthEntProp=()=>{
	let obj=Object.isFrozen(authEntCoreProp)?copyDeepFreeze(authEntCoreProp):authEntCoreProp;
	for (let el in obj){
		obj[el]['view']=authEntViewProp[el]['view'];
	}
	return obj;
};
//权限模块扩展后的属性
const authEntProp=extendAuthEntProp();
<!-- console.log(authEntProp); -->

//主要操作按钮显示属性
var oprtBtnProp={
	_CREATE:{chi:'新增',color:{lab:'label label-info',txt:'text-info',btn:'btn-info',bg:'bg-info'},glyCom:'<span class="glyphicon glyphicon-duplicate"></span>'},
	_EDIT:{chi:'编辑',color:{lab:'label label-primary',txt:'text-primary',btn:'btn-primary',bg:'bg-warning'},glyCom:'<span class="glyphicon glyphicon-edit"></span>'},
	_UPDATE:{chi:'保存',color:{lab:'label label-primary',txt:'text-primary',btn:'btn-primary',bg:'bg-info'},glyCom:'<span class="glyphicon glyphicon-saved"></span>'},
	_DELETE:{chi:'删除',color:{lab:'label label-danger',txt:'text-danger',btn:'btn-danger',bg:'bg-danger'},glyCom:'<span class="glyphicon glyphicon-remove"></span>'},
	_DISABLE:{chi:'禁用',color:{lab:'label label-warning',txt:'text-warning',btn:'btn-warning',bg:'bg-info'},glyCom:'<span class="glyphicon glyphicon-ban-circle"></span>'},
	_ENABLE:{chi:'启用',color:{lab:'label label-success',txt:'text-success',btn:'btn-success',bg:'bg-info'},glyCom:'<span class="glyphicon glyphicon-magnet"></span>'},
	_READ:{chi:'查询',color:{lab:'label label-info',txt:'text-info',btn:'btn-info',bg:'bg-info'},glyCom:'<span class="glyphicon glyphicon-search"></span>'},
	_REFRESH:{chi:'刷新',color:{lab:'label label-info',txt:'text-info',btn:'btn-info',bg:'bg-info'},glyCom:'<span class="glyphicon glyphicon-refresh"></span>'}
};

//spSet对象的span内容格式修改，供后续通过$.load()的页面使用
var spComModify=(spSet)=>{
	
	spSet.each(function(){
		let txt=$(this).text(),
			ent=$(this).closest('td').data('hideVal'),
			auth=(txt!=0)?authEntProp[ent]['auth'][txt]:'',
			rank=authEntProp[ent]['rank'],
			labColor=(txt==0)?'label label-default':authColor[rank]['bs3']['lab'];
		
		$(this).addClass(labColor);
		//将span的text转换成中文，格式修改	
		if(txt==0){
			$(this).text('无').css({'padding-bottom':'2px','font-weight':'400'});
		}else{
			$(this).text(auth.chi);
			//span的格式修改
			($(this).data('val'))?$(this).css('padding-bottom','2px'):$(this).addClass('text-muted');
		}
	});
};

var showSideNavbar=(show=true)=>{
	if(show){
		//show
		$('#openBtn').hide();
		$('#mySidenav').addClass('sidenav-show');
		$('#divContainer').addClass('sidenav-show');
		//添加div组件及其click事件函数，实现点击该组件就隐藏sideNave，还需结合sidenav-backdrop的css属性实现与sideNav的分层
		return $('body').append($('<div></div>').addClass('sidenav-backdrop').one('click',function(){
    		showSideNavbar(false);
			})
		);
	}
	
	$('#openBtn').show();
	$('#mySidenav').removeClass('sidenav-show');
	$('#divContainer').removeClass('sidenav-show');	
	$('div.sidenav-backdrop').remove();
	
	return true;	
};

//对表格$('#content table')的选定字段进行升、降序转换，并改变其显示格式
var sortOrderToggle=(tblObj='null')=>{
	let obj='',
		<!-- tbl=(tblObj=='null')?$('#tblUserList'):tblObj, -->
		tbl=(tblObj=='null')?$('#content table'):tblObj,
		aSet=tbl.find('thead a'),
		glyAsc='&nbsp;<span class="small glyphicon glyphicon-sort-by-attributes"></span>',
		glyDesc='&nbsp;<span class="small glyphicon glyphicon-sort-by-order-alt"></span>',
		sortOrder=sortData.order,
		sortName=sortData.name,
		labColor='label label-primary';
		
	aSet.removeClass(labColor).each(function(){
		let gly=(sortOrder=='asc')?glyAsc:glyDesc,
			order=(sortOrder=='asc')?'desc':'asc',
			title=(sortOrder=='asc')?'当前为升序。点击后降序':'当前为降序。点击后升序';
			
		if(sortName==$(this).data('sortName')){
			obj=$(this);
			obj.addClass(labColor).append(gly).data('sortOrder',order).attr('title',title).tooltip({placement: 'top'});
		}
		$(this).tooltip({placement: 'bottom'});
	});
	
	//选中进行排序的列向左对齐，添加底色
	tbl.find('tbody tr').each(function(){
		let n=obj.closest('th').prevAll().length;
		$(this).children('td').eq(n).removeClass('text-center').addClass('text-left bg-info');
	});
	
};

// 作用：提交锚点值给后端，由后端返回需加载的页面文件
var loadTplFile=(rqData={})=>{
	let sId=(window.location.hash==null)?archName[0]:window.location.hash,
		url=(archName.indexOf(sId)!=-1 )?sId.slice(1):archName[0].slice(1),
		aObj='',
		obj=$('#pageParam'),
		pageParamDefault={
			listRows:10,
			pageNum:1,
			showId:0,
			url:''},
		//page参数都从$('#pageParam')获取
		pageParam={
			listRows:obj.data('listRows'),
			pageNum:(url==obj.data('url'))?obj.data('pageNum'):1,
			showId:obj.data('showId'),
			url:url
		}
		rqDataDefault={
			sId:sId,
			pageParam:pageParam,
			searchData:'',
			sortData:''};
	
	aObj=$('a.aTab[href="'+sId+'"]');
	aObj.tab('show');
	pageParam=$.extend({},pageParamDefault,pageParam);
	rqData=$.extend({},rqDataDefault,rqData);
	http://sh.qihoo.com/pc/home?ch=youlike&sign=360_0ed9f8f8
	<!-- console.log(rqData); -->
    //提交锚点值给后端，由后端返回需加载的页面文件
	$("#content").load(url,rqData,function(){
		
	}); 
};
//表格$('#content table')内的特定行上底色
var	tblTrBg=(id='')=>{
	let obj=$('#content tbody'),
		trObj=obj.find('tr[data-id="'+id+'"]');
	//去掉所有行的底色
	obj.find('tr').removeClass('bg-warning');
	if(id==0){
		//默认给表内的第一行内容上底色
		obj.find('tr').eq(0).addClass('bg-warning');
	}else{
		//给本行上底色
		trObj.addClass('bg-warning');
	}
};

//btnOprt点击
var btnOprtClick=(obj,url)=>{
	let data={oprt:obj.data('oprt'),id:obj.closest('tr').data('id'),reqEnt:obj.data('reqEnt')},
		e=oprtBtnProp[data.oprt],
		mdObj=$('#modalSingle'),
		tdObj='',
		//操作结果字符串
		oprtStr='【<span class="'+e.color.txt+'">'+e.glyCom+e.chi+'</span>】';
		
	//是表格内的oprt按钮
	if(obj.closest('tr').length){
		tblTrBg(data.id);
		//分页参数向$('#pageParam')汇集
		$('#pageParam').data('showId',data.id);
	}
				
	if(data.oprt=='_ENABLE' || data.oprt=='_DISABLE'){
		tdObj=obj.closest('td');
		$.post(url,data,function(res){
			let str='';
			tdObj.data('enable',res.result);
			oprtBtnDisplay(tdObj);
			if(res.msg=='success'){
				str='<p class="text-center text-success">成功<span class="glyphicon glyphicon-ok"></span></p>';
			}else{
				str='<p class="text-center text-danger">失败<span class="glyphicon glyphicon-remove"></span></p>';
			}
			$.alert('<p class="text-center">用户组：<strong>'+res.name+'</strong>'+oprtStr+'</p>'+str);
		});
	}else{
		<!-- $('#content').html('<p class="text-center" style="font-size:28px;">加载中……</p>').load(url,data,function(){ -->
			<!-- mdObj.find('h4').html(oprtStr+'用户组'); -->
				
		<!-- }); -->
		
		mdObj.find('.modal-header').removeClass('bg-info bg-danger bg-warning').addClass(e.color.bg);			
		mdObj.find('.modal-body').html('<p class="text-center" style="font-size:28px;">加载中……</p>').load(url,data,function(){
			mdObj.find('h4').html(oprtStr+'用户组');
				
		});
		mdObj.on('shown.bs.modal', function () {
            $('#fmUsergroup').find('.inputCheck').eq(0).focus();
    	});
		mdObj.modal('show');
	}
};

//利用自调用匿名函数立即执行的特点， 页面初始化
(function($){
	//设定页面初始锚点/菜单
	if(window.location.hash==''){
		window.location.hash=archName[0];
	}
	showSideNavbar();	
	loadTplFile();
	// 激活tooltip
	$('[title]').tooltip();   
})(jQuery);

$(document).ready(function(){
	
	<!-- //点击nav-pills中的各个按钮后，显示对应的页面-->
	$('.aTab').click(function(){
    	//a所在li高亮
		$(this).tab('show');
		//a的href属性值即是页面的锚点值
		window.location.hash = $(this).attr('href'); 
		//加载锚点对应的页面文件
        loadTplFile();              
    });	
	
	//显示SideNavbar
	$('#openBtn').click(function(){
		showSideNavbar();
			
    });	
	//关闭SideNavbar
	$('#closeBtn').click(function(){
        showSideNavbar(false);
			
    });
	
});	

</script>

</body>

</html>